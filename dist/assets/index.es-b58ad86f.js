import{a as Yh,c as Er,r as Jr,e as p1,h as ee,j as d1,w as Xh,k as Zh,l as ta,t as ln,m as g1,I as Gr,A as v1,U as y1,L as m1,n as W,o as w1,s as Ko,v as _1,_ as b1,x as E1,V as zu,y as x1,D as I1,z as P1,Z as ku,$ as S1,B as C1,E as cn,G as O1,H as Qh,J as gr,K as A1,M as R1,X as Oi,N as tt,O as $t,Q as Kr,R as kt,S as T1,T as Ai,Y as el,a0 as N1,a1 as L1,a2 as D1,a3 as tl,a4 as F1,a5 as rl,a6 as il,a7 as Ti,a8 as Go,a9 as sn,aa as Li,ab as $1,ac as nn,ad as j1,ae as M1,af as q1,ag as U1,ah as z1,ai as Ro,aj as Hu,ak as k1,al as H1,am as B1,an as Bu,ao as V1,ap as K1,aq as G1,ar as W1,as as J1,at as Y1,au as X1,av as on,aw as sl,ax as To,ay as Z1,az as Q1}from"./index-dc415d61.js";var ra={exports:{}},Ni=typeof Reflect=="object"?Reflect:null,Vu=Ni&&typeof Ni.apply=="function"?Ni.apply:function(r,i,n){return Function.prototype.apply.call(r,i,n)},an;Ni&&typeof Ni.ownKeys=="function"?an=Ni.ownKeys:Object.getOwnPropertySymbols?an=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:an=function(r){return Object.getOwnPropertyNames(r)};function em(c){console&&console.warn&&console.warn(c)}var nl=Number.isNaN||function(r){return r!==r};function Te(){Te.init.call(this)}ra.exports=Te;ra.exports.once=sm;Te.EventEmitter=Te;Te.prototype._events=void 0;Te.prototype._eventsCount=0;Te.prototype._maxListeners=void 0;var Ku=10;function fn(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(Te,"defaultMaxListeners",{enumerable:!0,get:function(){return Ku},set:function(c){if(typeof c!="number"||c<0||nl(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");Ku=c}});Te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Te.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||nl(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function ol(c){return c._maxListeners===void 0?Te.defaultMaxListeners:c._maxListeners}Te.prototype.getMaxListeners=function(){return ol(this)};Te.prototype.emit=function(r){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var o=r==="error",h=this._events;if(h!==void 0)o=o&&h.error===void 0;else if(!o)return!1;if(o){var d;if(i.length>0&&(d=i[0]),d instanceof Error)throw d;var v=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw v.context=d,v}var w=h[r];if(w===void 0)return!1;if(typeof w=="function")Vu(w,this,i);else for(var P=w.length,L=ll(w,P),n=0;n<P;++n)Vu(L[n],this,i);return!0};function al(c,r,i,n){var o,h,d;if(fn(i),h=c._events,h===void 0?(h=c._events=Object.create(null),c._eventsCount=0):(h.newListener!==void 0&&(c.emit("newListener",r,i.listener?i.listener:i),h=c._events),d=h[r]),d===void 0)d=h[r]=i,++c._eventsCount;else if(typeof d=="function"?d=h[r]=n?[i,d]:[d,i]:n?d.unshift(i):d.push(i),o=ol(c),o>0&&d.length>o&&!d.warned){d.warned=!0;var v=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");v.name="MaxListenersExceededWarning",v.emitter=c,v.type=r,v.count=d.length,em(v)}return c}Te.prototype.addListener=function(r,i){return al(this,r,i,!1)};Te.prototype.on=Te.prototype.addListener;Te.prototype.prependListener=function(r,i){return al(this,r,i,!0)};function tm(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function cl(c,r,i){var n={fired:!1,wrapFn:void 0,target:c,type:r,listener:i},o=tm.bind(n);return o.listener=i,n.wrapFn=o,o}Te.prototype.once=function(r,i){return fn(i),this.on(r,cl(this,r,i)),this};Te.prototype.prependOnceListener=function(r,i){return fn(i),this.prependListener(r,cl(this,r,i)),this};Te.prototype.removeListener=function(r,i){var n,o,h,d,v;if(fn(i),o=this._events,o===void 0)return this;if(n=o[r],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete o[r],o.removeListener&&this.emit("removeListener",r,n.listener||i));else if(typeof n!="function"){for(h=-1,d=n.length-1;d>=0;d--)if(n[d]===i||n[d].listener===i){v=n[d].listener,h=d;break}if(h<0)return this;h===0?n.shift():rm(n,h),n.length===1&&(o[r]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",r,v||i)}return this};Te.prototype.off=Te.prototype.removeListener;Te.prototype.removeAllListeners=function(r){var i,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[r]),this;if(arguments.length===0){var h=Object.keys(n),d;for(o=0;o<h.length;++o)d=h[o],d!=="removeListener"&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[r],typeof i=="function")this.removeListener(r,i);else if(i!==void 0)for(o=i.length-1;o>=0;o--)this.removeListener(r,i[o]);return this};function ul(c,r,i){var n=c._events;if(n===void 0)return[];var o=n[r];return o===void 0?[]:typeof o=="function"?i?[o.listener||o]:[o]:i?im(o):ll(o,o.length)}Te.prototype.listeners=function(r){return ul(this,r,!0)};Te.prototype.rawListeners=function(r){return ul(this,r,!1)};Te.listenerCount=function(c,r){return typeof c.listenerCount=="function"?c.listenerCount(r):hl.call(c,r)};Te.prototype.listenerCount=hl;function hl(c){var r=this._events;if(r!==void 0){var i=r[c];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}Te.prototype.eventNames=function(){return this._eventsCount>0?an(this._events):[]};function ll(c,r){for(var i=new Array(r),n=0;n<r;++n)i[n]=c[n];return i}function rm(c,r){for(;r+1<c.length;r++)c[r]=c[r+1];c.pop()}function im(c){for(var r=new Array(c.length),i=0;i<r.length;++i)r[i]=c[i].listener||c[i];return r}function sm(c,r){return new Promise(function(i,n){function o(d){c.removeListener(r,h),n(d)}function h(){typeof c.removeListener=="function"&&c.removeListener("error",o),i([].slice.call(arguments))}fl(c,r,h,{once:!0}),r!=="error"&&nm(c,o,{once:!0})})}function nm(c,r,i){typeof c.on=="function"&&fl(c,"error",r,i)}function fl(c,r,i,n){if(typeof c.on=="function")n.once?c.once(r,i):c.on(r,i);else if(typeof c.addEventListener=="function")c.addEventListener(r,function o(h){n.once&&c.removeEventListener(r,o),i(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}var Xt=ra.exports;const ia=Yh(Xt);var pn={},hs={};Object.defineProperty(hs,"__esModule",{value:!0});function om(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return JSON.parse(c)}catch{return c}}hs.safeJsonParse=om;function am(c){return typeof c=="string"?c:JSON.stringify(c,(r,i)=>typeof i>"u"?null:i)}hs.safeJsonStringify=am;var Xi={exports:{}},Gu;function cm(){return Gu||(Gu=1,function(){let c;function r(){}c=r,c.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},c.prototype.setItem=function(i,n){this[i]=String(n)},c.prototype.removeItem=function(i){delete this[i]},c.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},c.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},c.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Er<"u"&&Er.localStorage?Xi.exports=Er.localStorage:typeof window<"u"&&window.localStorage?Xi.exports=window.localStorage:Xi.exports=new r}()),Xi.exports}var No={},Zi={},Wu;function um(){if(Wu)return Zi;Wu=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.IKeyValueStorage=void 0;class c{}return Zi.IKeyValueStorage=c,Zi}var Qi={},Ju;function hm(){if(Ju)return Qi;Ju=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.parseEntry=void 0;const c=hs;function r(i){var n;return[i[0],c.safeJsonParse((n=i[1])!==null&&n!==void 0?n:"")]}return Qi.parseEntry=r,Qi}var Yu;function lm(){return Yu||(Yu=1,function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Jr;r.__exportStar(um(),c),r.__exportStar(hm(),c)}(No)),No}Object.defineProperty(pn,"__esModule",{value:!0});pn.KeyValueStorage=void 0;const Ri=Jr,Xu=hs,fm=Ri.__importDefault(cm()),pm=lm();class pl{constructor(){this.localStorage=fm.default}getKeys(){return Ri.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Ri.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(pm.parseEntry)})}getItem(r){return Ri.__awaiter(this,void 0,void 0,function*(){const i=this.localStorage.getItem(r);if(i!==null)return Xu.safeJsonParse(i)})}setItem(r,i){return Ri.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(r,Xu.safeJsonStringify(i))})}removeItem(r){return Ri.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(r)})}}pn.KeyValueStorage=pl;var dm=pn.default=pl,Di={},es={},Lo={},ts={};let hi=class{};const gm=Object.freeze(Object.defineProperty({__proto__:null,IEvents:hi},Symbol.toStringTag,{value:"Module"})),vm=p1(gm);var Zu;function ym(){if(Zu)return ts;Zu=1,Object.defineProperty(ts,"__esModule",{value:!0}),ts.IHeartBeat=void 0;const c=vm;class r extends c.IEvents{constructor(n){super()}}return ts.IHeartBeat=r,ts}var Qu;function dl(){return Qu||(Qu=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),Jr.__exportStar(ym(),c)}(Lo)),Lo}var Do={},ci={},eh;function mm(){if(eh)return ci;eh=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.HEARTBEAT_EVENTS=ci.HEARTBEAT_INTERVAL=void 0;const c=ee;return ci.HEARTBEAT_INTERVAL=c.FIVE_SECONDS,ci.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ci}var th;function gl(){return th||(th=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),Jr.__exportStar(mm(),c)}(Do)),Do}var rh;function wm(){if(rh)return es;rh=1,Object.defineProperty(es,"__esModule",{value:!0}),es.HeartBeat=void 0;const c=Jr,r=Xt,i=ee,n=dl(),o=gl();class h extends n.IHeartBeat{constructor(v){super(v),this.events=new r.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(v==null?void 0:v.interval)||o.HEARTBEAT_INTERVAL}static init(v){return c.__awaiter(this,void 0,void 0,function*(){const w=new h(v);return yield w.init(),w})}init(){return c.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(v,w){this.events.on(v,w)}once(v,w){this.events.once(v,w)}off(v,w){this.events.off(v,w)}removeListener(v,w){this.events.removeListener(v,w)}initialize(){return c.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return es.HeartBeat=h,es}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Jr;r.__exportStar(wm(),c),r.__exportStar(dl(),c),r.__exportStar(gl(),c)})(Di);var Ee={},Fo,ih;function _m(){if(ih)return Fo;ih=1;function c(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}Fo=r;function r(i,n,o){var h=o&&o.stringify||c,d=1;if(typeof i=="object"&&i!==null){var v=n.length+d;if(v===1)return i;var w=new Array(v);w[0]=h(i);for(var P=1;P<v;P++)w[P]=h(n[P]);return w.join(" ")}if(typeof i!="string")return i;var L=n.length;if(L===0)return i;for(var H="",K=1-d,B=-1,F=i&&i.length||0,V=0;V<F;){if(i.charCodeAt(V)===37&&V+1<F){switch(B=B>-1?B:0,i.charCodeAt(V+1)){case 100:case 102:if(K>=L||n[K]==null)break;B<V&&(H+=i.slice(B,V)),H+=Number(n[K]),B=V+2,V++;break;case 105:if(K>=L||n[K]==null)break;B<V&&(H+=i.slice(B,V)),H+=Math.floor(Number(n[K])),B=V+2,V++;break;case 79:case 111:case 106:if(K>=L||n[K]===void 0)break;B<V&&(H+=i.slice(B,V));var ie=typeof n[K];if(ie==="string"){H+="'"+n[K]+"'",B=V+2,V++;break}if(ie==="function"){H+=n[K].name||"<anonymous>",B=V+2,V++;break}H+=h(n[K]),B=V+2,V++;break;case 115:if(K>=L)break;B<V&&(H+=i.slice(B,V)),H+=String(n[K]),B=V+2,V++;break;case 37:B<V&&(H+=i.slice(B,V)),H+="%",B=V+2,V++,K--;break}++K}++V}return B===-1?i:(B<F&&(H+=i.slice(B)),H)}return Fo}var $o,sh;function bm(){if(sh)return $o;sh=1;const c=_m();$o=o;const r=ce().console||{},i={mapHttpRequest:F,mapHttpResponse:F,wrapRequestSerializer:V,wrapResponseSerializer:V,wrapErrorSerializer:V,req:F,res:F,err:K};function n(A,j){return Array.isArray(A)?A.filter(function(fe){return fe!=="!stdSerializers.err"}):A===!0?Object.keys(j):!1}function o(A){A=A||{},A.browser=A.browser||{};const j=A.browser.transmit;if(j&&typeof j.send!="function")throw Error("pino: transmit option must have a send function");const z=A.browser.write||r;A.browser.write&&(A.browser.asObject=!0);const fe=A.serializers||{},Z=n(A.browser.serialize,fe);let ne=A.browser.serialize;Array.isArray(A.browser.serialize)&&A.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ne=!1);const Ce=["error","fatal","warn","info","debug","trace"];typeof z=="function"&&(z.error=z.fatal=z.warn=z.info=z.debug=z.trace=z),A.enabled===!1&&(A.level="silent");const De=A.level||"info",g=Object.create(z);g.log||(g.log=ie),Object.defineProperty(g,"levelVal",{get:J}),Object.defineProperty(g,"level",{get:se,set:q});const b={transmit:j,serialize:Z,asObject:A.browser.asObject,levels:Ce,timestamp:B(A)};g.levels=o.levels,g.level=De,g.setMaxListeners=g.getMaxListeners=g.emit=g.addListener=g.on=g.prependListener=g.once=g.prependOnceListener=g.removeListener=g.removeAllListeners=g.listeners=g.listenerCount=g.eventNames=g.write=g.flush=ie,g.serializers=fe,g._serialize=Z,g._stdErrSerialize=ne,g.child=$,j&&(g._logEvent=H());function J(){return this.level==="silent"?1/0:this.levels.values[this.level]}function se(){return this._level}function q(M){if(M!=="silent"&&!this.levels.values[M])throw Error("unknown level "+M);this._level=M,h(b,g,"error","log"),h(b,g,"fatal","error"),h(b,g,"warn","error"),h(b,g,"info","log"),h(b,g,"debug","log"),h(b,g,"trace","log")}function $(M,U){if(!M)throw new Error("missing bindings for child Pino");U=U||{},Z&&M.serializers&&(U.serializers=M.serializers);const qe=U.serializers;if(Z&&qe){var je=Object.assign({},fe,qe),Fr=A.browser.serialize===!0?Object.keys(je):Z;delete M.serializers,w([M],Fr,je,this._stdErrSerialize)}function Ht(xt){this._childLevel=(xt._childLevel|0)+1,this.error=P(xt,M,"error"),this.fatal=P(xt,M,"fatal"),this.warn=P(xt,M,"warn"),this.info=P(xt,M,"info"),this.debug=P(xt,M,"debug"),this.trace=P(xt,M,"trace"),je&&(this.serializers=je,this._serialize=Fr),j&&(this._logEvent=H([].concat(xt._logEvent.bindings,M)))}return Ht.prototype=this,new Ht(this)}return g}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=i,o.stdTimeFunctions=Object.assign({},{nullTime:ve,epochTime:we,unixTime:le,isoTime:oe});function h(A,j,z,fe){const Z=Object.getPrototypeOf(j);j[z]=j.levelVal>j.levels.values[z]?ie:Z[z]?Z[z]:r[z]||r[fe]||ie,d(A,j,z)}function d(A,j,z){!A.transmit&&j[z]===ie||(j[z]=function(fe){return function(){const ne=A.timestamp(),Ce=new Array(arguments.length),De=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var g=0;g<Ce.length;g++)Ce[g]=arguments[g];if(A.serialize&&!A.asObject&&w(Ce,this._serialize,this.serializers,this._stdErrSerialize),A.asObject?fe.call(De,v(this,z,Ce,ne)):fe.apply(De,Ce),A.transmit){const b=A.transmit.level||j.level,J=o.levels.values[b],se=o.levels.values[z];if(se<J)return;L(this,{ts:ne,methodLevel:z,methodValue:se,transmitLevel:b,transmitValue:o.levels.values[A.transmit.level||j.level],send:A.transmit.send,val:j.levelVal},Ce)}}}(j[z]))}function v(A,j,z,fe){A._serialize&&w(z,A._serialize,A.serializers,A._stdErrSerialize);const Z=z.slice();let ne=Z[0];const Ce={};fe&&(Ce.time=fe),Ce.level=o.levels.values[j];let De=(A._childLevel|0)+1;if(De<1&&(De=1),ne!==null&&typeof ne=="object"){for(;De--&&typeof Z[0]=="object";)Object.assign(Ce,Z.shift());ne=Z.length?c(Z.shift(),Z):void 0}else typeof ne=="string"&&(ne=c(Z.shift(),Z));return ne!==void 0&&(Ce.msg=ne),Ce}function w(A,j,z,fe){for(const Z in A)if(fe&&A[Z]instanceof Error)A[Z]=o.stdSerializers.err(A[Z]);else if(typeof A[Z]=="object"&&!Array.isArray(A[Z]))for(const ne in A[Z])j&&j.indexOf(ne)>-1&&ne in z&&(A[Z][ne]=z[ne](A[Z][ne]))}function P(A,j,z){return function(){const fe=new Array(1+arguments.length);fe[0]=j;for(var Z=1;Z<fe.length;Z++)fe[Z]=arguments[Z-1];return A[z].apply(this,fe)}}function L(A,j,z){const fe=j.send,Z=j.ts,ne=j.methodLevel,Ce=j.methodValue,De=j.val,g=A._logEvent.bindings;w(z,A._serialize||Object.keys(A.serializers),A.serializers,A._stdErrSerialize===void 0?!0:A._stdErrSerialize),A._logEvent.ts=Z,A._logEvent.messages=z.filter(function(b){return g.indexOf(b)===-1}),A._logEvent.level.label=ne,A._logEvent.level.value=Ce,fe(ne,A._logEvent,De),A._logEvent=H(g)}function H(A){return{ts:0,messages:[],bindings:A||[],level:{label:"",value:0}}}function K(A){const j={type:A.constructor.name,msg:A.message,stack:A.stack};for(const z in A)j[z]===void 0&&(j[z]=A[z]);return j}function B(A){return typeof A.timestamp=="function"?A.timestamp:A.timestamp===!1?ve:we}function F(){return{}}function V(A){return A}function ie(){}function ve(){return!1}function we(){return Date.now()}function le(){return Math.round(Date.now()/1e3)}function oe(){return new Date(Date.now()).toISOString()}function ce(){function A(j){return typeof j<"u"&&j}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return A(self)||A(window)||A(this)||{}}}return $o}var ui={},nh;function vl(){return nh||(nh=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.PINO_CUSTOM_CONTEXT_KEY=ui.PINO_LOGGER_DEFAULTS=void 0,ui.PINO_LOGGER_DEFAULTS={level:"info"},ui.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ui}var Ft={},oh;function Em(){if(oh)return Ft;oh=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.generateChildLogger=Ft.formatChildLoggerContext=Ft.getLoggerContext=Ft.setBrowserLoggerContext=Ft.getBrowserLoggerContext=Ft.getDefaultLoggerOptions=void 0;const c=vl();function r(v){return Object.assign(Object.assign({},v),{level:(v==null?void 0:v.level)||c.PINO_LOGGER_DEFAULTS.level})}Ft.getDefaultLoggerOptions=r;function i(v,w=c.PINO_CUSTOM_CONTEXT_KEY){return v[w]||""}Ft.getBrowserLoggerContext=i;function n(v,w,P=c.PINO_CUSTOM_CONTEXT_KEY){return v[P]=w,v}Ft.setBrowserLoggerContext=n;function o(v,w=c.PINO_CUSTOM_CONTEXT_KEY){let P="";return typeof v.bindings>"u"?P=i(v,w):P=v.bindings().context||"",P}Ft.getLoggerContext=o;function h(v,w,P=c.PINO_CUSTOM_CONTEXT_KEY){const L=o(v,P);return L.trim()?`${L}/${w}`:w}Ft.formatChildLoggerContext=h;function d(v,w,P=c.PINO_CUSTOM_CONTEXT_KEY){const L=h(v,w,P),H=v.child({context:L});return n(H,L,P)}return Ft.generateChildLogger=d,Ft}(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.pino=void 0;const r=Jr,i=r.__importDefault(bm());Object.defineProperty(c,"pino",{enumerable:!0,get:function(){return i.default}}),r.__exportStar(vl(),c),r.__exportStar(Em(),c)})(Ee);class xm extends hi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class Im extends hi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class Pm{constructor(r,i){this.logger=r,this.core=i}}let Sm=class extends hi{constructor(r,i){super(),this.relayer=r,this.logger=i}},Cm=class extends hi{constructor(r){super()}},Om=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class Am extends hi{constructor(r,i){super(),this.relayer=r,this.logger=i}}let Rm=class extends hi{constructor(r,i){super(),this.core=r,this.logger=i}},Tm=class{constructor(r,i){this.projectId=r,this.logger=i}},Nm=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},Lm=class{constructor(r){this.client=r}};const Dm=c=>JSON.stringify(c,(r,i)=>typeof i=="bigint"?i.toString()+"n":i),Fm=c=>{const r=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=c.replace(r,'$1"$2n"$3');return JSON.parse(i,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function sa(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return Fm(c)}catch{return c}}function us(c){return typeof c=="string"?c:Dm(c)||""}var na={},yl={};(function(c){Object.defineProperty(c,"__esModule",{value:!0});var r=d1,i=Xh;c.DIGEST_LENGTH=64,c.BLOCK_SIZE=128;var n=function(){function v(){this.digestLength=c.DIGEST_LENGTH,this.blockSize=c.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return v.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},v.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},v.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},v.prototype.update=function(w,P){if(P===void 0&&(P=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var L=0;if(this._bytesHashed+=P,this._bufferLength>0){for(;this._bufferLength<c.BLOCK_SIZE&&P>0;)this._buffer[this._bufferLength++]=w[L++],P--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(P>=this.blockSize&&(L=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,L,P),P%=this.blockSize);P>0;)this._buffer[this._bufferLength++]=w[L++],P--;return this},v.prototype.finish=function(w){if(!this._finished){var P=this._bytesHashed,L=this._bufferLength,H=P/536870912|0,K=P<<3,B=P%128<112?128:256;this._buffer[L]=128;for(var F=L+1;F<B-8;F++)this._buffer[F]=0;r.writeUint32BE(H,this._buffer,B-8),r.writeUint32BE(K,this._buffer,B-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,B),this._finished=!0}for(var F=0;F<this.digestLength/8;F++)r.writeUint32BE(this._stateHi[F],w,F*8),r.writeUint32BE(this._stateLo[F],w,F*8+4);return this},v.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},v.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},v.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},v.prototype.cleanSavedState=function(w){i.wipe(w.stateHi),i.wipe(w.stateLo),w.buffer&&i.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},v}();c.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(v,w,P,L,H,K,B){for(var F=P[0],V=P[1],ie=P[2],ve=P[3],we=P[4],le=P[5],oe=P[6],ce=P[7],A=L[0],j=L[1],z=L[2],fe=L[3],Z=L[4],ne=L[5],Ce=L[6],De=L[7],g,b,J,se,q,$,M,U;B>=128;){for(var qe=0;qe<16;qe++){var je=8*qe+K;v[qe]=r.readUint32BE(H,je),w[qe]=r.readUint32BE(H,je+4)}for(var qe=0;qe<80;qe++){var Fr=F,Ht=V,xt=ie,C=ve,O=we,I=le,u=oe,_=ce,X=A,ue=j,ye=z,Pe=fe,Oe=Z,xe=ne,at=Ce,rt=De;if(g=ce,b=De,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=(we>>>14|Z<<32-14)^(we>>>18|Z<<32-18)^(Z>>>41-32|we<<32-(41-32)),b=(Z>>>14|we<<32-14)^(Z>>>18|we<<32-18)^(we>>>41-32|Z<<32-(41-32)),q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,g=we&le^~we&oe,b=Z&ne^~Z&Ce,q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,g=o[qe*2],b=o[qe*2+1],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,g=v[qe%16],b=w[qe%16],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,J=M&65535|U<<16,se=q&65535|$<<16,g=J,b=se,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=(F>>>28|A<<32-28)^(A>>>34-32|F<<32-(34-32))^(A>>>39-32|F<<32-(39-32)),b=(A>>>28|F<<32-28)^(F>>>34-32|A<<32-(34-32))^(F>>>39-32|A<<32-(39-32)),q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,g=F&V^F&ie^V&ie,b=A&j^A&z^j&z,q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,_=M&65535|U<<16,rt=q&65535|$<<16,g=C,b=Pe,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=J,b=se,q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,C=M&65535|U<<16,Pe=q&65535|$<<16,V=Fr,ie=Ht,ve=xt,we=C,le=O,oe=I,ce=u,F=_,j=X,z=ue,fe=ye,Z=Pe,ne=Oe,Ce=xe,De=at,A=rt,qe%16===15)for(var je=0;je<16;je++)g=v[je],b=w[je],q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=v[(je+9)%16],b=w[(je+9)%16],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,J=v[(je+1)%16],se=w[(je+1)%16],g=(J>>>1|se<<32-1)^(J>>>8|se<<32-8)^J>>>7,b=(se>>>1|J<<32-1)^(se>>>8|J<<32-8)^(se>>>7|J<<32-7),q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,J=v[(je+14)%16],se=w[(je+14)%16],g=(J>>>19|se<<32-19)^(se>>>61-32|J<<32-(61-32))^J>>>6,b=(se>>>19|J<<32-19)^(J>>>61-32|se<<32-(61-32))^(se>>>6|J<<32-6),q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,v[je]=M&65535|U<<16,w[je]=q&65535|$<<16}g=F,b=A,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[0],b=L[0],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[0]=F=M&65535|U<<16,L[0]=A=q&65535|$<<16,g=V,b=j,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[1],b=L[1],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[1]=V=M&65535|U<<16,L[1]=j=q&65535|$<<16,g=ie,b=z,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[2],b=L[2],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[2]=ie=M&65535|U<<16,L[2]=z=q&65535|$<<16,g=ve,b=fe,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[3],b=L[3],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[3]=ve=M&65535|U<<16,L[3]=fe=q&65535|$<<16,g=we,b=Z,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[4],b=L[4],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[4]=we=M&65535|U<<16,L[4]=Z=q&65535|$<<16,g=le,b=ne,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[5],b=L[5],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[5]=le=M&65535|U<<16,L[5]=ne=q&65535|$<<16,g=oe,b=Ce,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[6],b=L[6],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[6]=oe=M&65535|U<<16,L[6]=Ce=q&65535|$<<16,g=ce,b=De,q=b&65535,$=b>>>16,M=g&65535,U=g>>>16,g=P[7],b=L[7],q+=b&65535,$+=b>>>16,M+=g&65535,U+=g>>>16,$+=q>>>16,M+=$>>>16,U+=M>>>16,P[7]=ce=M&65535|U<<16,L[7]=De=q&65535|$<<16,K+=128,B-=128}return K}function d(v){var w=new n;w.update(v);var P=w.digest();return w.clean(),P}c.hash=d})(yl);(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.convertSecretKeyToX25519=c.convertPublicKeyToX25519=c.verify=c.sign=c.extractPublicKeyFromSecretKey=c.generateKeyPair=c.generateKeyPairFromSeed=c.SEED_LENGTH=c.SECRET_KEY_LENGTH=c.PUBLIC_KEY_LENGTH=c.SIGNATURE_LENGTH=void 0;const r=Zh,i=yl,n=Xh;c.SIGNATURE_LENGTH=64,c.PUBLIC_KEY_LENGTH=32,c.SECRET_KEY_LENGTH=64,c.SEED_LENGTH=32;function o(C){const O=new Float64Array(16);if(C)for(let I=0;I<C.length;I++)O[I]=C[I];return O}const h=new Uint8Array(32);h[0]=9;const d=o(),v=o([1]),w=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),P=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),L=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),H=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),K=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function B(C,O){for(let I=0;I<16;I++)C[I]=O[I]|0}function F(C){let O=1;for(let I=0;I<16;I++){let u=C[I]+O+65535;O=Math.floor(u/65536),C[I]=u-O*65536}C[0]+=O-1+37*(O-1)}function V(C,O,I){const u=~(I-1);for(let _=0;_<16;_++){const X=u&(C[_]^O[_]);C[_]^=X,O[_]^=X}}function ie(C,O){const I=o(),u=o();for(let _=0;_<16;_++)u[_]=O[_];F(u),F(u),F(u);for(let _=0;_<2;_++){I[0]=u[0]-65517;for(let ue=1;ue<15;ue++)I[ue]=u[ue]-65535-(I[ue-1]>>16&1),I[ue-1]&=65535;I[15]=u[15]-32767-(I[14]>>16&1);const X=I[15]>>16&1;I[14]&=65535,V(u,I,1-X)}for(let _=0;_<16;_++)C[2*_]=u[_]&255,C[2*_+1]=u[_]>>8}function ve(C,O){let I=0;for(let u=0;u<32;u++)I|=C[u]^O[u];return(1&I-1>>>8)-1}function we(C,O){const I=new Uint8Array(32),u=new Uint8Array(32);return ie(I,C),ie(u,O),ve(I,u)}function le(C){const O=new Uint8Array(32);return ie(O,C),O[0]&1}function oe(C,O){for(let I=0;I<16;I++)C[I]=O[2*I]+(O[2*I+1]<<8);C[15]&=32767}function ce(C,O,I){for(let u=0;u<16;u++)C[u]=O[u]+I[u]}function A(C,O,I){for(let u=0;u<16;u++)C[u]=O[u]-I[u]}function j(C,O,I){let u,_,X=0,ue=0,ye=0,Pe=0,Oe=0,xe=0,at=0,rt=0,We=0,Re=0,ze=0,ke=0,Je=0,Fe=0,He=0,Ne=0,Be=0,it=0,ct=0,It=0,Ot=0,Tt=0,jt=0,Bt=0,Zt=0,hr=0,$r=0,Zr=0,fi=0,pi=0,Fi=0,ut=I[0],ht=I[1],lt=I[2],ft=I[3],st=I[4],pt=I[5],dt=I[6],gt=I[7],Qe=I[8],vt=I[9],et=I[10],yt=I[11],mt=I[12],wt=I[13],_t=I[14],bt=I[15];u=O[0],X+=u*ut,ue+=u*ht,ye+=u*lt,Pe+=u*ft,Oe+=u*st,xe+=u*pt,at+=u*dt,rt+=u*gt,We+=u*Qe,Re+=u*vt,ze+=u*et,ke+=u*yt,Je+=u*mt,Fe+=u*wt,He+=u*_t,Ne+=u*bt,u=O[1],ue+=u*ut,ye+=u*ht,Pe+=u*lt,Oe+=u*ft,xe+=u*st,at+=u*pt,rt+=u*dt,We+=u*gt,Re+=u*Qe,ze+=u*vt,ke+=u*et,Je+=u*yt,Fe+=u*mt,He+=u*wt,Ne+=u*_t,Be+=u*bt,u=O[2],ye+=u*ut,Pe+=u*ht,Oe+=u*lt,xe+=u*ft,at+=u*st,rt+=u*pt,We+=u*dt,Re+=u*gt,ze+=u*Qe,ke+=u*vt,Je+=u*et,Fe+=u*yt,He+=u*mt,Ne+=u*wt,Be+=u*_t,it+=u*bt,u=O[3],Pe+=u*ut,Oe+=u*ht,xe+=u*lt,at+=u*ft,rt+=u*st,We+=u*pt,Re+=u*dt,ze+=u*gt,ke+=u*Qe,Je+=u*vt,Fe+=u*et,He+=u*yt,Ne+=u*mt,Be+=u*wt,it+=u*_t,ct+=u*bt,u=O[4],Oe+=u*ut,xe+=u*ht,at+=u*lt,rt+=u*ft,We+=u*st,Re+=u*pt,ze+=u*dt,ke+=u*gt,Je+=u*Qe,Fe+=u*vt,He+=u*et,Ne+=u*yt,Be+=u*mt,it+=u*wt,ct+=u*_t,It+=u*bt,u=O[5],xe+=u*ut,at+=u*ht,rt+=u*lt,We+=u*ft,Re+=u*st,ze+=u*pt,ke+=u*dt,Je+=u*gt,Fe+=u*Qe,He+=u*vt,Ne+=u*et,Be+=u*yt,it+=u*mt,ct+=u*wt,It+=u*_t,Ot+=u*bt,u=O[6],at+=u*ut,rt+=u*ht,We+=u*lt,Re+=u*ft,ze+=u*st,ke+=u*pt,Je+=u*dt,Fe+=u*gt,He+=u*Qe,Ne+=u*vt,Be+=u*et,it+=u*yt,ct+=u*mt,It+=u*wt,Ot+=u*_t,Tt+=u*bt,u=O[7],rt+=u*ut,We+=u*ht,Re+=u*lt,ze+=u*ft,ke+=u*st,Je+=u*pt,Fe+=u*dt,He+=u*gt,Ne+=u*Qe,Be+=u*vt,it+=u*et,ct+=u*yt,It+=u*mt,Ot+=u*wt,Tt+=u*_t,jt+=u*bt,u=O[8],We+=u*ut,Re+=u*ht,ze+=u*lt,ke+=u*ft,Je+=u*st,Fe+=u*pt,He+=u*dt,Ne+=u*gt,Be+=u*Qe,it+=u*vt,ct+=u*et,It+=u*yt,Ot+=u*mt,Tt+=u*wt,jt+=u*_t,Bt+=u*bt,u=O[9],Re+=u*ut,ze+=u*ht,ke+=u*lt,Je+=u*ft,Fe+=u*st,He+=u*pt,Ne+=u*dt,Be+=u*gt,it+=u*Qe,ct+=u*vt,It+=u*et,Ot+=u*yt,Tt+=u*mt,jt+=u*wt,Bt+=u*_t,Zt+=u*bt,u=O[10],ze+=u*ut,ke+=u*ht,Je+=u*lt,Fe+=u*ft,He+=u*st,Ne+=u*pt,Be+=u*dt,it+=u*gt,ct+=u*Qe,It+=u*vt,Ot+=u*et,Tt+=u*yt,jt+=u*mt,Bt+=u*wt,Zt+=u*_t,hr+=u*bt,u=O[11],ke+=u*ut,Je+=u*ht,Fe+=u*lt,He+=u*ft,Ne+=u*st,Be+=u*pt,it+=u*dt,ct+=u*gt,It+=u*Qe,Ot+=u*vt,Tt+=u*et,jt+=u*yt,Bt+=u*mt,Zt+=u*wt,hr+=u*_t,$r+=u*bt,u=O[12],Je+=u*ut,Fe+=u*ht,He+=u*lt,Ne+=u*ft,Be+=u*st,it+=u*pt,ct+=u*dt,It+=u*gt,Ot+=u*Qe,Tt+=u*vt,jt+=u*et,Bt+=u*yt,Zt+=u*mt,hr+=u*wt,$r+=u*_t,Zr+=u*bt,u=O[13],Fe+=u*ut,He+=u*ht,Ne+=u*lt,Be+=u*ft,it+=u*st,ct+=u*pt,It+=u*dt,Ot+=u*gt,Tt+=u*Qe,jt+=u*vt,Bt+=u*et,Zt+=u*yt,hr+=u*mt,$r+=u*wt,Zr+=u*_t,fi+=u*bt,u=O[14],He+=u*ut,Ne+=u*ht,Be+=u*lt,it+=u*ft,ct+=u*st,It+=u*pt,Ot+=u*dt,Tt+=u*gt,jt+=u*Qe,Bt+=u*vt,Zt+=u*et,hr+=u*yt,$r+=u*mt,Zr+=u*wt,fi+=u*_t,pi+=u*bt,u=O[15],Ne+=u*ut,Be+=u*ht,it+=u*lt,ct+=u*ft,It+=u*st,Ot+=u*pt,Tt+=u*dt,jt+=u*gt,Bt+=u*Qe,Zt+=u*vt,hr+=u*et,$r+=u*yt,Zr+=u*mt,fi+=u*wt,pi+=u*_t,Fi+=u*bt,X+=38*Be,ue+=38*it,ye+=38*ct,Pe+=38*It,Oe+=38*Ot,xe+=38*Tt,at+=38*jt,rt+=38*Bt,We+=38*Zt,Re+=38*hr,ze+=38*$r,ke+=38*Zr,Je+=38*fi,Fe+=38*pi,He+=38*Fi,_=1,u=X+_+65535,_=Math.floor(u/65536),X=u-_*65536,u=ue+_+65535,_=Math.floor(u/65536),ue=u-_*65536,u=ye+_+65535,_=Math.floor(u/65536),ye=u-_*65536,u=Pe+_+65535,_=Math.floor(u/65536),Pe=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=xe+_+65535,_=Math.floor(u/65536),xe=u-_*65536,u=at+_+65535,_=Math.floor(u/65536),at=u-_*65536,u=rt+_+65535,_=Math.floor(u/65536),rt=u-_*65536,u=We+_+65535,_=Math.floor(u/65536),We=u-_*65536,u=Re+_+65535,_=Math.floor(u/65536),Re=u-_*65536,u=ze+_+65535,_=Math.floor(u/65536),ze=u-_*65536,u=ke+_+65535,_=Math.floor(u/65536),ke=u-_*65536,u=Je+_+65535,_=Math.floor(u/65536),Je=u-_*65536,u=Fe+_+65535,_=Math.floor(u/65536),Fe=u-_*65536,u=He+_+65535,_=Math.floor(u/65536),He=u-_*65536,u=Ne+_+65535,_=Math.floor(u/65536),Ne=u-_*65536,X+=_-1+37*(_-1),_=1,u=X+_+65535,_=Math.floor(u/65536),X=u-_*65536,u=ue+_+65535,_=Math.floor(u/65536),ue=u-_*65536,u=ye+_+65535,_=Math.floor(u/65536),ye=u-_*65536,u=Pe+_+65535,_=Math.floor(u/65536),Pe=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=xe+_+65535,_=Math.floor(u/65536),xe=u-_*65536,u=at+_+65535,_=Math.floor(u/65536),at=u-_*65536,u=rt+_+65535,_=Math.floor(u/65536),rt=u-_*65536,u=We+_+65535,_=Math.floor(u/65536),We=u-_*65536,u=Re+_+65535,_=Math.floor(u/65536),Re=u-_*65536,u=ze+_+65535,_=Math.floor(u/65536),ze=u-_*65536,u=ke+_+65535,_=Math.floor(u/65536),ke=u-_*65536,u=Je+_+65535,_=Math.floor(u/65536),Je=u-_*65536,u=Fe+_+65535,_=Math.floor(u/65536),Fe=u-_*65536,u=He+_+65535,_=Math.floor(u/65536),He=u-_*65536,u=Ne+_+65535,_=Math.floor(u/65536),Ne=u-_*65536,X+=_-1+37*(_-1),C[0]=X,C[1]=ue,C[2]=ye,C[3]=Pe,C[4]=Oe,C[5]=xe,C[6]=at,C[7]=rt,C[8]=We,C[9]=Re,C[10]=ze,C[11]=ke,C[12]=Je,C[13]=Fe,C[14]=He,C[15]=Ne}function z(C,O){j(C,O,O)}function fe(C,O){const I=o();let u;for(u=0;u<16;u++)I[u]=O[u];for(u=253;u>=0;u--)z(I,I),u!==2&&u!==4&&j(I,I,O);for(u=0;u<16;u++)C[u]=I[u]}function Z(C,O){const I=o();let u;for(u=0;u<16;u++)I[u]=O[u];for(u=250;u>=0;u--)z(I,I),u!==1&&j(I,I,O);for(u=0;u<16;u++)C[u]=I[u]}function ne(C,O){const I=o(),u=o(),_=o(),X=o(),ue=o(),ye=o(),Pe=o(),Oe=o(),xe=o();A(I,C[1],C[0]),A(xe,O[1],O[0]),j(I,I,xe),ce(u,C[0],C[1]),ce(xe,O[0],O[1]),j(u,u,xe),j(_,C[3],O[3]),j(_,_,P),j(X,C[2],O[2]),ce(X,X,X),A(ue,u,I),A(ye,X,_),ce(Pe,X,_),ce(Oe,u,I),j(C[0],ue,ye),j(C[1],Oe,Pe),j(C[2],Pe,ye),j(C[3],ue,Oe)}function Ce(C,O,I){for(let u=0;u<4;u++)V(C[u],O[u],I)}function De(C,O){const I=o(),u=o(),_=o();fe(_,O[2]),j(I,O[0],_),j(u,O[1],_),ie(C,u),C[31]^=le(I)<<7}function g(C,O,I){B(C[0],d),B(C[1],v),B(C[2],v),B(C[3],d);for(let u=255;u>=0;--u){const _=I[u/8|0]>>(u&7)&1;Ce(C,O,_),ne(O,C),ne(C,C),Ce(C,O,_)}}function b(C,O){const I=[o(),o(),o(),o()];B(I[0],L),B(I[1],H),B(I[2],v),j(I[3],L,H),g(C,I,O)}function J(C){if(C.length!==c.SEED_LENGTH)throw new Error(`ed25519: seed must be ${c.SEED_LENGTH} bytes`);const O=(0,i.hash)(C);O[0]&=248,O[31]&=127,O[31]|=64;const I=new Uint8Array(32),u=[o(),o(),o(),o()];b(u,O),De(I,u);const _=new Uint8Array(64);return _.set(C),_.set(I,32),{publicKey:I,secretKey:_}}c.generateKeyPairFromSeed=J;function se(C){const O=(0,r.randomBytes)(32,C),I=J(O);return(0,n.wipe)(O),I}c.generateKeyPair=se;function q(C){if(C.length!==c.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${c.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}c.extractPublicKeyFromSecretKey=q;const $=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function M(C,O){let I,u,_,X;for(u=63;u>=32;--u){for(I=0,_=u-32,X=u-12;_<X;++_)O[_]+=I-16*O[u]*$[_-(u-32)],I=Math.floor((O[_]+128)/256),O[_]-=I*256;O[_]+=I,O[u]=0}for(I=0,_=0;_<32;_++)O[_]+=I-(O[31]>>4)*$[_],I=O[_]>>8,O[_]&=255;for(_=0;_<32;_++)O[_]-=I*$[_];for(u=0;u<32;u++)O[u+1]+=O[u]>>8,C[u]=O[u]&255}function U(C){const O=new Float64Array(64);for(let I=0;I<64;I++)O[I]=C[I];for(let I=0;I<64;I++)C[I]=0;M(C,O)}function qe(C,O){const I=new Float64Array(64),u=[o(),o(),o(),o()],_=(0,i.hash)(C.subarray(0,32));_[0]&=248,_[31]&=127,_[31]|=64;const X=new Uint8Array(64);X.set(_.subarray(32),32);const ue=new i.SHA512;ue.update(X.subarray(32)),ue.update(O);const ye=ue.digest();ue.clean(),U(ye),b(u,ye),De(X,u),ue.reset(),ue.update(X.subarray(0,32)),ue.update(C.subarray(32)),ue.update(O);const Pe=ue.digest();U(Pe);for(let Oe=0;Oe<32;Oe++)I[Oe]=ye[Oe];for(let Oe=0;Oe<32;Oe++)for(let xe=0;xe<32;xe++)I[Oe+xe]+=Pe[Oe]*_[xe];return M(X.subarray(32),I),X}c.sign=qe;function je(C,O){const I=o(),u=o(),_=o(),X=o(),ue=o(),ye=o(),Pe=o();return B(C[2],v),oe(C[1],O),z(_,C[1]),j(X,_,w),A(_,_,C[2]),ce(X,C[2],X),z(ue,X),z(ye,ue),j(Pe,ye,ue),j(I,Pe,_),j(I,I,X),Z(I,I),j(I,I,_),j(I,I,X),j(I,I,X),j(C[0],I,X),z(u,C[0]),j(u,u,X),we(u,_)&&j(C[0],C[0],K),z(u,C[0]),j(u,u,X),we(u,_)?-1:(le(C[0])===O[31]>>7&&A(C[0],d,C[0]),j(C[3],C[0],C[1]),0)}function Fr(C,O,I){const u=new Uint8Array(32),_=[o(),o(),o(),o()],X=[o(),o(),o(),o()];if(I.length!==c.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${c.SIGNATURE_LENGTH} bytes`);if(je(X,C))return!1;const ue=new i.SHA512;ue.update(I.subarray(0,32)),ue.update(C),ue.update(O);const ye=ue.digest();return U(ye),g(_,X,ye),b(X,I.subarray(32)),ne(_,X),De(u,_),!ve(I,u)}c.verify=Fr;function Ht(C){let O=[o(),o(),o(),o()];if(je(O,C))throw new Error("Ed25519: invalid public key");let I=o(),u=o(),_=O[1];ce(I,v,_),A(u,v,_),fe(u,u),j(I,I,u);let X=new Uint8Array(32);return ie(X,I),X}c.convertPublicKeyToX25519=Ht;function xt(C){const O=(0,i.hash)(C.subarray(0,32));O[0]&=248,O[31]&=127,O[31]|=64;const I=new Uint8Array(O.subarray(0,32));return(0,n.wipe)(O),I}c.convertSecretKeyToX25519=xt})(na);const $m="EdDSA",jm="JWT",ml=".",wl="base64url",Mm="utf8",qm="utf8",Um=":",zm="did",km="key",ah="base58btc",Hm="z",Bm="K36",Vm=32;function un(c){return ln(ta(us(c),Mm),wl)}function _l(c){const r=ta(Bm,ah),i=Hm+ln(g1([r,c]),ah);return[zm,km,i].join(Um)}function Km(c){return ln(c,wl)}function Gm(c){return ta([un(c.header),un(c.payload)].join(ml),qm)}function Wm(c){return[un(c.header),un(c.payload),Km(c.signature)].join(ml)}function ch(c=Zh.randomBytes(Vm)){return na.generateKeyPairFromSeed(c)}async function Jm(c,r,i,n,o=ee.fromMiliseconds(Date.now())){const h={alg:$m,typ:jm},d=_l(n.publicKey),v=o+i,w={iss:d,sub:c,aud:r,iat:o,exp:v},P=Gm({header:h,payload:w}),L=na.sign(n.secretKey,P);return Wm({header:h,payload:w,signature:L})}const Ym="PARSE_ERROR",Xm="INVALID_REQUEST",Zm="METHOD_NOT_FOUND",Qm="INVALID_PARAMS",bl="INTERNAL_ERROR",oa="SERVER_ERROR",ew=[-32700,-32600,-32601,-32602,-32603],cs={[Ym]:{code:-32700,message:"Parse error"},[Xm]:{code:-32600,message:"Invalid Request"},[Zm]:{code:-32601,message:"Method not found"},[Qm]:{code:-32602,message:"Invalid params"},[bl]:{code:-32603,message:"Internal error"},[oa]:{code:-32e3,message:"Server error"}},El=oa;function tw(c){return ew.includes(c)}function uh(c){return Object.keys(cs).includes(c)?cs[c]:cs[El]}function rw(c){const r=Object.values(cs).find(i=>i.code===c);return r||cs[El]}function xl(c,r,i){return c.message.includes("getaddrinfo ENOTFOUND")||c.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${r}`):c}var Il={},Nr={},hh;function iw(){if(hh)return Nr;hh=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.isBrowserCryptoAvailable=Nr.getSubtleCrypto=Nr.getBrowerCrypto=void 0;function c(){return(Er===null||Er===void 0?void 0:Er.crypto)||(Er===null||Er===void 0?void 0:Er.msCrypto)||{}}Nr.getBrowerCrypto=c;function r(){const n=c();return n.subtle||n.webkitSubtle}Nr.getSubtleCrypto=r;function i(){return!!c()&&!!r()}return Nr.isBrowserCryptoAvailable=i,Nr}var Lr={},lh;function sw(){if(lh)return Lr;lh=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.isBrowser=Lr.isNode=Lr.isReactNative=void 0;function c(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Lr.isReactNative=c;function r(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Lr.isNode=r;function i(){return!c()&&!r()}return Lr.isBrowser=i,Lr}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Jr;r.__exportStar(iw(),c),r.__exportStar(sw(),c)})(Il);function Pl(c=3){const r=Date.now()*Math.pow(10,c),i=Math.floor(Math.random()*Math.pow(10,c));return r+i}function aa(c=6){return BigInt(Pl(c))}function dn(c,r,i){return{id:i||Pl(),jsonrpc:"2.0",method:c,params:r}}function ca(c,r){return{id:c,jsonrpc:"2.0",result:r}}function gn(c,r,i){return{id:c,jsonrpc:"2.0",error:nw(r,i)}}function nw(c,r){return typeof c>"u"?uh(bl):(typeof c=="string"&&(c=Object.assign(Object.assign({},uh(oa)),{message:c})),typeof r<"u"&&(c.data=r),tw(c.code)&&(c=rw(c.code)),c)}class ow{}class aw extends ow{constructor(){super()}}class cw extends aw{constructor(r){super()}}const uw="^https?:",hw="^wss?:";function lw(c){const r=c.match(new RegExp(/^\w+:/,"gi"));if(!(!r||!r.length))return r[0]}function Sl(c,r){const i=lw(c);return typeof i>"u"?!1:new RegExp(r).test(i)}function fh(c){return Sl(c,uw)}function ph(c){return Sl(c,hw)}function fw(c){return new RegExp("wss?://localhost(:d{2,5})?").test(c)}function Cl(c){return typeof c=="object"&&"id"in c&&"jsonrpc"in c&&c.jsonrpc==="2.0"}function ua(c){return Cl(c)&&"method"in c}function vn(c){return Cl(c)&&(Dr(c)||vr(c))}function Dr(c){return"result"in c}function vr(c){return"error"in c}class Yr extends cw{constructor(r){super(r),this.events=new Xt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async request(r,i){return this.requestStrict(dn(r.method,r.params||[],r.id||aa().toString()),i)}async requestStrict(r,i){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${r.id}`,h=>{vr(h)?o(h.error):n(h.result)});try{await this.connection.send(r,i)}catch(h){o(h)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),vn(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const pw=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),dw=()=>typeof window<"u",dh=c=>c.split("?")[0],gh=10,gw=pw();class vw{constructor(r){if(this.url=r,this.events=new Xt.EventEmitter,this.registering=!1,!ph(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(us(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!ph(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const o=Il.isReactNative()?void 0:{rejectUnauthorized:!fw(r)},h=new gw(r,[],o);dw()?h.onerror=d=>{const v=d;n(this.emitError(v.error))}:h.on("error",d=>{n(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),i(h)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?sa(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=gn(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return xl(r,dh(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>gh&&this.events.setMaxListeners(gh)}emitError(r){const i=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${dh(this.url)}`));return this.events.emit("register_error",i),i}}function yw(c,r){if(c.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<c.length;o++){var h=c.charAt(o),d=h.charCodeAt(0);if(i[d]!==255)throw new TypeError(h+" is ambiguous");i[d]=o}var v=c.length,w=c.charAt(0),P=Math.log(v)/Math.log(256),L=Math.log(256)/Math.log(v);function H(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var V=0,ie=0,ve=0,we=F.length;ve!==we&&F[ve]===0;)ve++,V++;for(var le=(we-ve)*L+1>>>0,oe=new Uint8Array(le);ve!==we;){for(var ce=F[ve],A=0,j=le-1;(ce!==0||A<ie)&&j!==-1;j--,A++)ce+=256*oe[j]>>>0,oe[j]=ce%v>>>0,ce=ce/v>>>0;if(ce!==0)throw new Error("Non-zero carry");ie=A,ve++}for(var z=le-ie;z!==le&&oe[z]===0;)z++;for(var fe=w.repeat(V);z<le;++z)fe+=c.charAt(oe[z]);return fe}function K(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var V=0;if(F[V]!==" "){for(var ie=0,ve=0;F[V]===w;)ie++,V++;for(var we=(F.length-V)*P+1>>>0,le=new Uint8Array(we);F[V];){var oe=i[F.charCodeAt(V)];if(oe===255)return;for(var ce=0,A=we-1;(oe!==0||ce<ve)&&A!==-1;A--,ce++)oe+=v*le[A]>>>0,le[A]=oe%256>>>0,oe=oe/256>>>0;if(oe!==0)throw new Error("Non-zero carry");ve=ce,V++}if(F[V]!==" "){for(var j=we-ve;j!==we&&le[j]===0;)j++;for(var z=new Uint8Array(ie+(we-j)),fe=ie;j!==we;)z[fe++]=le[j++];return z}}}function B(F){var V=K(F);if(V)return V;throw new Error(`Non-${r} character`)}return{encode:H,decodeUnsafe:K,decode:B}}var mw=yw,ww=mw;const Ol=c=>{if(c instanceof Uint8Array&&c.constructor.name==="Uint8Array")return c;if(c instanceof ArrayBuffer)return new Uint8Array(c);if(ArrayBuffer.isView(c))return new Uint8Array(c.buffer,c.byteOffset,c.byteLength);throw new Error("Unknown type, must be binary type")},_w=c=>new TextEncoder().encode(c),bw=c=>new TextDecoder().decode(c);class Ew{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class xw{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Al(this,r)}}class Iw{constructor(r){this.decoders=r}or(r){return Al(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Al=(c,r)=>new Iw({...c.decoders||{[c.prefix]:c},...r.decoders||{[r.prefix]:r}});class Pw{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new Ew(r,i,n),this.decoder=new xw(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const yn=({name:c,prefix:r,encode:i,decode:n})=>new Pw(c,r,i,n),ls=({prefix:c,name:r,alphabet:i})=>{const{encode:n,decode:o}=ww(i,r);return yn({prefix:c,name:r,encode:n,decode:h=>Ol(o(h))})},Sw=(c,r,i,n)=>{const o={};for(let L=0;L<r.length;++L)o[r[L]]=L;let h=c.length;for(;c[h-1]==="=";)--h;const d=new Uint8Array(h*i/8|0);let v=0,w=0,P=0;for(let L=0;L<h;++L){const H=o[c[L]];if(H===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|H,v+=i,v>=8&&(v-=8,d[P++]=255&w>>v)}if(v>=i||255&w<<8-v)throw new SyntaxError("Unexpected end of data");return d},Cw=(c,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",d=0,v=0;for(let w=0;w<c.length;++w)for(v=v<<8|c[w],d+=8;d>i;)d-=i,h+=r[o&v>>d];if(d&&(h+=r[o&v<<i-d]),n)for(;h.length*i&7;)h+="=";return h},Ct=({name:c,prefix:r,bitsPerChar:i,alphabet:n})=>yn({prefix:r,name:c,encode(o){return Cw(o,n,i)},decode(o){return Sw(o,n,i,c)}}),Ow=yn({prefix:"\0",name:"identity",encode:c=>bw(c),decode:c=>_w(c)});var Aw=Object.freeze({__proto__:null,identity:Ow});const Rw=Ct({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Tw=Object.freeze({__proto__:null,base2:Rw});const Nw=Ct({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Lw=Object.freeze({__proto__:null,base8:Nw});const Dw=ls({prefix:"9",name:"base10",alphabet:"0123456789"});var Fw=Object.freeze({__proto__:null,base10:Dw});const $w=Ct({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jw=Ct({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Mw=Object.freeze({__proto__:null,base16:$w,base16upper:jw});const qw=Ct({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uw=Ct({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zw=Ct({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kw=Ct({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hw=Ct({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Bw=Ct({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vw=Ct({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Kw=Ct({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gw=Ct({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ww=Object.freeze({__proto__:null,base32:qw,base32upper:Uw,base32pad:zw,base32padupper:kw,base32hex:Hw,base32hexupper:Bw,base32hexpad:Vw,base32hexpadupper:Kw,base32z:Gw});const Jw=ls({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Yw=ls({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Xw=Object.freeze({__proto__:null,base36:Jw,base36upper:Yw});const Zw=ls({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qw=ls({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var e_=Object.freeze({__proto__:null,base58btc:Zw,base58flickr:Qw});const t_=Ct({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r_=Ct({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i_=Ct({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s_=Ct({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var n_=Object.freeze({__proto__:null,base64:t_,base64pad:r_,base64url:i_,base64urlpad:s_});const Rl=Array.from(""),o_=Rl.reduce((c,r,i)=>(c[i]=r,c),[]),a_=Rl.reduce((c,r,i)=>(c[r.codePointAt(0)]=i,c),[]);function c_(c){return c.reduce((r,i)=>(r+=o_[i],r),"")}function u_(c){const r=[];for(const i of c){const n=a_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const h_=yn({prefix:"",name:"base256emoji",encode:c_,decode:u_});var l_=Object.freeze({__proto__:null,base256emoji:h_}),f_=Tl,vh=128,p_=127,d_=~p_,g_=Math.pow(2,31);function Tl(c,r,i){r=r||[],i=i||0;for(var n=i;c>=g_;)r[i++]=c&255|vh,c/=128;for(;c&d_;)r[i++]=c&255|vh,c>>>=7;return r[i]=c|0,Tl.bytes=i-n+1,r}var v_=Wo,y_=128,yh=127;function Wo(c,n){var i=0,n=n||0,o=0,h=n,d,v=c.length;do{if(h>=v)throw Wo.bytes=0,new RangeError("Could not decode varint");d=c[h++],i+=o<28?(d&yh)<<o:(d&yh)*Math.pow(2,o),o+=7}while(d>=y_);return Wo.bytes=h-n,i}var m_=Math.pow(2,7),w_=Math.pow(2,14),__=Math.pow(2,21),b_=Math.pow(2,28),E_=Math.pow(2,35),x_=Math.pow(2,42),I_=Math.pow(2,49),P_=Math.pow(2,56),S_=Math.pow(2,63),C_=function(c){return c<m_?1:c<w_?2:c<__?3:c<b_?4:c<E_?5:c<x_?6:c<I_?7:c<P_?8:c<S_?9:10},O_={encode:f_,decode:v_,encodingLength:C_},Nl=O_;const mh=(c,r,i=0)=>(Nl.encode(c,r,i),r),wh=c=>Nl.encodingLength(c),Jo=(c,r)=>{const i=r.byteLength,n=wh(c),o=n+wh(i),h=new Uint8Array(o+i);return mh(c,h,0),mh(i,h,n),h.set(r,o),new A_(c,i,r,h)};class A_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const Ll=({name:c,code:r,encode:i})=>new R_(c,r,i);class R_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?Jo(this.code,i):i.then(n=>Jo(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Dl=c=>async r=>new Uint8Array(await crypto.subtle.digest(c,r)),T_=Ll({name:"sha2-256",code:18,encode:Dl("SHA-256")}),N_=Ll({name:"sha2-512",code:19,encode:Dl("SHA-512")});var L_=Object.freeze({__proto__:null,sha256:T_,sha512:N_});const Fl=0,D_="identity",$l=Ol,F_=c=>Jo(Fl,$l(c)),$_={code:Fl,name:D_,encode:$l,digest:F_};var j_=Object.freeze({__proto__:null,identity:$_});new TextEncoder,new TextDecoder;const _h={...Aw,...Tw,...Lw,...Fw,...Mw,...Ww,...Xw,...e_,...n_,...l_};({...L_,...j_});function jl(c){return globalThis.Buffer!=null?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):c}function M_(c=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?jl(globalThis.Buffer.allocUnsafe(c)):new Uint8Array(c)}function Ml(c,r,i,n){return{name:c,prefix:r,encoder:{name:c,prefix:r,encode:i},decoder:{decode:n}}}const bh=Ml("utf8","u",c=>"u"+new TextDecoder("utf8").decode(c),c=>new TextEncoder().encode(c.substring(1))),jo=Ml("ascii","a",c=>{let r="a";for(let i=0;i<c.length;i++)r+=String.fromCharCode(c[i]);return r},c=>{c=c.substring(1);const r=M_(c.length);for(let i=0;i<c.length;i++)r[i]=c.charCodeAt(i);return r}),q_={utf8:bh,"utf-8":bh,hex:_h.base16,latin1:jo,ascii:jo,binary:jo,..._h};function U_(c,r="utf8"){const i=q_[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?jl(globalThis.Buffer.from(c,"utf-8")):i.decoder.decode(`${i.prefix}${c}`)}const ql="wc",z_=2,ha="core",Wr=`${ql}@2:${ha}:`,k_={name:ha,logger:"error"},H_={database:":memory:"},B_="crypto",Eh="client_ed25519_seed",V_=ee.ONE_DAY,K_="keychain",G_="0.3",W_="messages",J_="0.3",Y_=ee.SIX_HOURS,X_="publisher",Ul="irn",Z_="error",zl="wss://relay.walletconnect.com",xh="wss://relay.walletconnect.org",Q_="relayer",Ge={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},eb="_subscription",rs={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},tb=ee.ONE_SECOND/2,rb="2.9.0",ib=1e4,sb="0.3",nb="WALLETCONNECT_CLIENT_ID",br={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},ob="subscription",ab="0.3",cb=ee.FIVE_SECONDS*1e3,ub="pairing",hb="0.3",is={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},_r={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},lb="history",fb="0.3",pb="expirer",cr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},db="0.3",Mo="verify-api",Ih="https://verify.walletconnect.com";class gb{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=K_,this.version=G_,this.initialized=!1,this.storagePrefix=Wr,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=W("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ee.generateChildLogger(i,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,rl(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?il(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class vb{constructor(r,i,n){this.core=r,this.logger=i,this.name=B_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=ch(o);return _l(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=w1();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=ch(h),v=Ko();return await Jm(v,o,V_,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const v=this.getPrivateKey(o),w=_1(v,h);return this.setSymKey(w,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||b1(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const v=E1(d),w=us(h);if(zu(v)){const K=v.senderPublicKey,B=v.receiverPublicKey;o=await this.generateSharedKey(K,B)}const P=this.getSymKey(o),{type:L,senderPublicKey:H}=v;return x1({type:L,symKey:P,message:w,senderPublicKey:H})},this.decode=async(o,h,d)=>{this.isInitialized();const v=I1(h,d);if(zu(v)){const L=v.receiverPublicKey,H=v.senderPublicKey;o=await this.generateSharedKey(L,H)}const w=this.getSymKey(o),P=P1({symKey:w,encoded:h});return sa(P)},this.getPayloadType=o=>{const h=ku(o);return S1(h.type)},this.getPayloadSenderPublicKey=o=>{const h=ku(o);return h.senderPublicKey?ln(h.senderPublicKey,C1):void 0},this.core=r,this.logger=Ee.generateChildLogger(i,this.name),this.keychain=n||new gb(this.core,this.logger)}get context(){return Ee.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Eh)}catch{r=Ko(),await this.keychain.set(Eh,r)}return U_(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class yb extends Pm{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=W_,this.version=J_,this.initialized=!1,this.storagePrefix=Wr,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=Ti(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=Ti(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ee.generateChildLogger(r,this.name),this.core=i}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,rl(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?il(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class mb extends Sm{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Xt.EventEmitter,this.name=X_,this.queue=new Map,this.publishTimeout=ee.toMiliseconds(ee.TEN_SECONDS),this.queueTimeout=ee.toMiliseconds(ee.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const d=(h==null?void 0:h.ttl)||Y_,v=Go(h),w=(h==null?void 0:h.prompt)||!1,P=(h==null?void 0:h.tag)||0,L=(h==null?void 0:h.id)||aa().toString(),H={topic:n,message:o,opts:{ttl:d,relay:v,prompt:w,tag:P,id:L}},K=setTimeout(()=>this.queue.set(L,H),this.queueTimeout);try{await await cn(this.rpcPublish(n,o,d,v,w,P,L),this.publishTimeout),clearTimeout(K),this.relayer.events.emit(Ge.publish,H)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Ee.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Ee.getLoggerContext(this.logger)}rpcPublish(r,i,n,o,h,d,v){var w,P,L,H;const K={method:sn(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:d},id:v};return Gr((w=K.params)==null?void 0:w.prompt)&&((P=K.params)==null||delete P.prompt),Gr((L=K.params)==null?void 0:L.tag)&&((H=K.params)==null||delete H.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:K}),this.relayer.request(K)}onPublish(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(Di.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ge.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ge.message_ack,r=>{this.onPublish(r.id.toString())})}}class wb{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var _b=Object.defineProperty,bb=Object.defineProperties,Eb=Object.getOwnPropertyDescriptors,Ph=Object.getOwnPropertySymbols,xb=Object.prototype.hasOwnProperty,Ib=Object.prototype.propertyIsEnumerable,Sh=(c,r,i)=>r in c?_b(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ss=(c,r)=>{for(var i in r||(r={}))xb.call(r,i)&&Sh(c,i,r[i]);if(Ph)for(var i of Ph(r))Ib.call(r,i)&&Sh(c,i,r[i]);return c},qo=(c,r)=>bb(c,Eb(r));class Pb extends Am{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new wb,this.events=new Xt.EventEmitter,this.name=ob,this.version=ab,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Wr,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=Go(o),d={topic:n,relay:h};this.pending.set(n,d);const v=await this.rpcSubscribe(n,h);return this.onSubscribe(v,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),v}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const d=new ee.Watch;d.start(this.pendingSubscriptionWatchLabel);const v=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=cb&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ee.generateChildLogger(i,this.name),this.clientId=""}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=Go(n);await this.rpcUnsubscribe(r,i,o);const h=$t("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:sn(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await cn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ge.connection_stalled)}return Ti(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:sn(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await cn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ge.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:sn(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,qo(ss({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,ss({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,ss({},i)),this.topicMap.set(i.topic,r),this.events.emit(br.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(br.deleted,qo(ss({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(br.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(br.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);Li(i)&&this.onBatchSubscribe(i.map((n,o)=>qo(ss({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Di.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ge.connect,async()=>{await this.onConnect()}),this.relayer.on(Ge.disconnect,()=>{this.onDisconnect()}),this.events.on(br.created,async r=>{const i=br.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(br.deleted,async r=>{const i=br.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var Sb=Object.defineProperty,Ch=Object.getOwnPropertySymbols,Cb=Object.prototype.hasOwnProperty,Ob=Object.prototype.propertyIsEnumerable,Oh=(c,r,i)=>r in c?Sb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Ab=(c,r)=>{for(var i in r||(r={}))Cb.call(r,i)&&Oh(c,i,r[i]);if(Ch)for(var i of Ch(r))Ob.call(r,i)&&Oh(c,i,r[i]);return c};class Rb extends Cm{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Xt.EventEmitter,this.name=Q_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ee.generateChildLogger(r.logger,this.name):Ee.pino(Ee.getDefaultLoggerOptions({level:r.logger||Z_})),this.messages=new yb(this.logger,r.core),this.subscriber=new Pb(this,this.logger),this.publisher=new mb(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||zl,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${xh}...`),await this.restartTransport(xh)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},ib)}get context(){return Ee.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";return o||(await Promise.all([new Promise(h=>{this.subscriber.once(br.created,d=>{d.topic===r&&h()})}),new Promise(async h=>{o=await this.subscriber.subscribe(r,i),h()})]),o)}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Ge.transport_closed))}async transportOpen(r){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=r||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(i=>{this.initialized||i(),this.subscriber.once(br.resubscribed,()=>{i()})}),await Promise.race([new Promise(async(i,n)=>{await cn(this.provider.connect(),5e3,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>n(o)).then(()=>i()).finally(()=>this.removeListener(Ge.transport_closed,this.rejectTransportOpen))}),new Promise(i=>this.once(Ge.transport_closed,this.rejectTransportOpen))])])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.events.emit(Ge.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(r){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=r||this.relayUrl,this.connected&&await Promise.all([new Promise(i=>{this.provider.once(rs.disconnect,()=>{i()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Yr(new vw(O1({sdkVersion:rb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;return await this.subscriber.isSubscribed(i)?this.messages.has(i,n):!0}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),ua(r)){if(!r.method.endsWith(eb))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ab({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else vn(r)&&this.events.emit(Ge.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Ge.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=ca(r.id,!0);await this.provider.connection.send(i)}registerProviderListeners(){this.provider.on(rs.payload,r=>this.onProviderPayload(r)),this.provider.on(rs.connect,()=>{this.events.emit(Ge.connect)}),this.provider.on(rs.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(rs.error,r=>{this.logger.error(r),this.events.emit(Ge.error,r)})}registerEventListeners(){this.events.on(Ge.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Ge.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},ee.toMiliseconds(tb))}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Tb=Object.defineProperty,Ah=Object.getOwnPropertySymbols,Nb=Object.prototype.hasOwnProperty,Lb=Object.prototype.propertyIsEnumerable,Rh=(c,r,i)=>r in c?Tb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Th=(c,r)=>{for(var i in r||(r={}))Nb.call(r,i)&&Rh(c,i,r[i]);if(Ah)for(var i of Ah(r))Lb.call(r,i)&&Rh(c,i,r[i]);return c};class mn extends Om{constructor(r,i,n,o=Wr,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=sb,this.cached=[],this.initialized=!1,this.storagePrefix=Wr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!Gr(d)?this.map.set(this.getKey(d),d):v1(d)?this.map.set(d.id,d):y1(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,v)=>{this.isInitialized(),this.map.has(d)?await this.update(d,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:v}),this.map.set(d,v),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(v=>Object.keys(d).every(w=>m1(v[w],d[w]))):this.values),this.update=async(d,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:v});const w=Th(Th({},this.getData(d)),v);this.map.set(d,w),await this.persist()},this.delete=async(d,v)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:v}),this.map.delete(d),await this.persist())},this.logger=Ee.generateChildLogger(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Db{constructor(r,i){this.core=r,this.logger=i,this.name=ub,this.version=hb,this.events=new ia,this.initialized=!1,this.storagePrefix=Wr,this.ignoredPayloadTypes=[Qh],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Ko(),o=await this.core.crypto.setSymKey(n),h=gr(ee.FIVE_MINUTES),d={protocol:Ul},v={topic:o,expiry:h,relay:d,active:!1},w=A1({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,v),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d}=R1(n.uri);if(this.pairings.keys.includes(o))throw new Error(`Pairing already exists: ${o}`);if(this.core.crypto.hasKeys(o))throw new Error(`Keychain already exists: ${o}`);const v=gr(ee.FIVE_MINUTES),w={topic:o,relay:d,expiry:v,active:!1};return await this.pairings.set(o,w),await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d}),this.core.expirer.set(o,v),n.activatePairing&&await this.activate({topic:o}),w},this.activate=async({topic:n})=>{this.isInitialized();const o=gr(ee.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:v,reject:w}=Oi();this.events.once(tt("pairing_ping",h),({error:P})=>{P?w(P):v()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",$t("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=dn(o,h),v=await this.core.crypto.encode(n,d),w=is[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,v,w),d.id},this.sendResult=async(n,o,h)=>{const d=ca(n,h),v=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),P=is[w.request.method].res;await this.core.relayer.publish(o,v,P),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=gn(n,h),v=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),P=is[w.request.method]?is[w.request.method].res:is.unregistered_method.res;await this.core.relayer.publish(o,v,P),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,$t("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Kr(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n,d=h.method;if(this.pairings.keys.includes(o))switch(d){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;if(this.pairings.keys.includes(o))switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit("pairing_ping",{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{Dr(o)?this.events.emit(tt("pairing_ping",h),{}):vr(o)&&this.events.emit(tt("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const v=$t("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,v),this.logger.error(v)}catch(v){await this.sendError(h,n,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error($t("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!kt(n)){const{message:o}=W("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!T1(n.uri)){const{message:o}=W("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!kt(n)){const{message:h}=W("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!kt(n)){const{message:h}=W("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!Ai(n,!1)){const{message:o}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Kr(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=W("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Ee.generateChildLogger(i,this.name),this.pairings=new mn(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Ge.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);ua(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):vn(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))})}registerExpirerEvents(){this.core.expirer.on(cr.expired,async r=>{const{topic:i}=el(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit("pairing_expire",{topic:i}))})}}class Fb extends Im{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Xt.EventEmitter,this.name=lb,this.version=fb,this.cached=[],this.initialized=!1,this.storagePrefix=Wr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:gr(ee.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(_r.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=vr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(_r.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(_r.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ee.generateChildLogger(i,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:dn(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_r.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(_r.created,r=>{const i=_r.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(_r.updated,r=>{const i=_r.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(_r.deleted,r=>{const i=_r.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(Di.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{ee.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class $b extends Rm{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Xt.EventEmitter,this.name=pb,this.version=db,this.cached=[],this.initialized=!1,this.storagePrefix=Wr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(cr.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(cr.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ee.generateChildLogger(i,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return N1(r);if(typeof r=="number")return L1(r);const{message:i}=W("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(cr.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;ee.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(cr.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(Di.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(cr.created,r=>{const i=cr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(cr.expired,r=>{const i=cr.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(cr.deleted,r=>{const i=cr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}}class jb extends Tm{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=Mo,this.initialized=!1,this.init=async n=>{D1()||!tl()||(this.verifyUrl=(n==null?void 0:n.verifyUrl)||Ih,await this.createIframe())},this.register=async n=>{var o;if(this.initialized||await this.init(),!!this.iframe)try{(o=this.iframe.contentWindow)==null||o.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async n=>{var o;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const h=this.startAbortTimer(ee.FIVE_SECONDS),d=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?(o=await d.json())==null?void 0:o.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,o)=>{if(document.getElementById(Mo))return n();const h=document.createElement("iframe");h.setAttribute("id",Mo),h.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),h.style.display="none",h.addEventListener("load",()=>{this.initialized=!0,n()}),h.addEventListener("error",d=>{o(d)}),document.body.append(h),this.iframe=h}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),ee.toMiliseconds(ee.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=Ee.generateChildLogger(i,this.name),this.verifyUrl=Ih,this.abortController=new AbortController,this.isDevEnv=F1()&&{}.IS_VITEST}get context(){return Ee.getLoggerContext(this.logger)}startAbortTimer(r){return setTimeout(()=>this.abortController.abort(),ee.toMiliseconds(r))}}var Mb=Object.defineProperty,Nh=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Ub=Object.prototype.propertyIsEnumerable,Lh=(c,r,i)=>r in c?Mb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Dh=(c,r)=>{for(var i in r||(r={}))qb.call(r,i)&&Lh(c,i,r[i]);if(Nh)for(var i of Nh(r))Ub.call(r,i)&&Lh(c,i,r[i]);return c};class la extends xm{constructor(r){super(r),this.protocol=ql,this.version=z_,this.name=ha,this.events=new Xt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||zl;const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||k_.logger}));this.logger=Ee.generateChildLogger(i,this.name),this.heartbeat=new Di.HeartBeat,this.crypto=new vb(this,this.logger,r==null?void 0:r.keychain),this.history=new Fb(this,this.logger),this.expirer=new $b(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new dm(Dh(Dh({},H_),r==null?void 0:r.storageOptions)),this.relayer=new Rb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Db(this,this.logger),this.verify=new jb(this.projectId||"",this.logger)}static async init(r){const i=new la(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(nb,n),i}get context(){return Ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const zb=la,kl="wc",Hl=2,Bl="client",fa=`${kl}@${Hl}:${Bl}:`,Uo={name:Bl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},kb="WALLETCONNECT_DEEPLINK_CHOICE",Hb="proposal",Vl="Proposal expired",Bb="session",en=ee.SEVEN_DAYS,Vb="engine",ns={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1115}}},zo={min:ee.FIVE_MINUTES,max:ee.SEVEN_DAYS},Kb="request",Gb=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Wb=Object.defineProperty,Jb=Object.defineProperties,Yb=Object.getOwnPropertyDescriptors,Fh=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,Zb=Object.prototype.propertyIsEnumerable,$h=(c,r,i)=>r in c?Wb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ar=(c,r)=>{for(var i in r||(r={}))Xb.call(r,i)&&$h(c,i,r[i]);if(Fh)for(var i of Fh(r))Zb.call(r,i)&&$h(c,i,r[i]);return c},ko=(c,r)=>Jb(c,Yb(r));class Qb extends Lm{constructor(r){super(r),this.name=Vb,this.events=new ia,this.initialized=!1,this.ignoredPayloadTypes=[Qh],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(ns)}),this.initialized=!0)},this.connect=async i=>{this.isInitialized();const n=ko(ar({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:v,relays:w}=n;let P=o,L,H=!1;if(P&&(H=this.client.core.pairing.pairings.get(P).active),!P||!H){const{topic:le,uri:oe}=await this.client.core.pairing.create();P=le,L=oe}const K=await this.client.core.crypto.generateKeyPair(),B=ar({requiredNamespaces:h,optionalNamespaces:d,relays:w??[{protocol:Ul}],proposer:{publicKey:K,metadata:this.client.metadata}},v&&{sessionProperties:v}),{reject:F,resolve:V,done:ie}=Oi(ee.FIVE_MINUTES,Vl);if(this.events.once(tt("session_connect"),async({error:le,session:oe})=>{if(le)F(le);else if(oe){oe.self.publicKey=K;const ce=ko(ar({},oe),{requiredNamespaces:oe.requiredNamespaces,optionalNamespaces:oe.optionalNamespaces});await this.client.session.set(oe.topic,ce),await this.setExpiry(oe.topic,oe.expiry),P&&await this.client.core.pairing.updateMetadata({topic:P,metadata:oe.peer.metadata}),V(ce)}}),!P){const{message:le}=W("NO_MATCHING_KEY",`connect() pairing topic: ${P}`);throw new Error(le)}const ve=await this.sendRequest(P,"wc_sessionPropose",B),we=gr(ee.FIVE_MINUTES);return await this.setProposal(ve,ar({id:ve,expiry:we},B)),{uri:L,approval:ie}},this.pair=async i=>(this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=i,v=this.client.proposal.get(n);let{pairingTopic:w,proposer:P,requiredNamespaces:L,optionalNamespaces:H}=v;w=w||"",nn(L)||(L=j1(h,"approve()"));const K=await this.client.core.crypto.generateKeyPair(),B=P.publicKey,F=await this.client.core.crypto.generateSharedKey(K,B);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:P.metadata}),await this.sendResult(n,w,{relay:{protocol:o??"irn"},responderPublicKey:K}),await this.client.proposal.delete(n,$t("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const V=ar({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:L,optionalNamespaces:H,pairingTopic:w,controller:{publicKey:K,metadata:this.client.metadata},expiry:gr(en)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(F),await this.sendRequest(F,"wc_sessionSettle",V);const ie=ko(ar({},V),{topic:F,pairingTopic:w,acknowledged:!1,self:V.controller,peer:{publicKey:P.publicKey,metadata:P.metadata},controller:K});return await this.client.session.set(F,ie),await this.setExpiry(F,gr(en)),{topic:F,acknowledged:()=>new Promise(ve=>setTimeout(()=>ve(this.client.session.get(F)),500))}},this.reject=async i=>{this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,$t("USER_DISCONNECTED")))},this.update=async i=>{this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:o}),{done:d,resolve:v,reject:w}=Oi();return this.events.once(tt("session_update",h),({error:P})=>{P?w(P):v()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async i=>{this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest(n,"wc_sessionExtend",{}),{done:h,resolve:d,reject:v}=Oi();return this.events.once(tt("session_extend",o),({error:w})=>{w?v(w):d()}),await this.setExpiry(n,gr(en)),{acknowledged:h}},this.request=async i=>{this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:d}=i,v=await this.sendRequest(h,"wc_sessionRequest",{request:o,chainId:n},d),{done:w,resolve:P,reject:L}=Oi(d);this.events.once(tt("session_request",v),({error:K,result:B})=>{K?L(K):P(B)}),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:v});const H=await this.client.core.storage.getItem(kb);return M1({id:v,topic:h,wcDeepLink:H}),await w()},this.respond=async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;Dr(o)?await this.sendResult(h,n,o.result):vr(o)&&await this.sendError(h,n,o.error),this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0})},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest(n,"wc_sessionPing",{}),{done:h,resolve:d,reject:v}=Oi();this.events.once(tt("session_ping",o),({error:w})=>{w?v(w):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest(n,"wc_sessionEvent",{event:o,chainId:h})},this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=aa().toString();let h;const d=v=>{(v==null?void 0:v.id.toString())===o&&(this.client.core.relayer.events.removeListener(Ge.message_ack,d),h())};await Promise.all([new Promise(v=>{h=v,this.client.core.relayer.on(Ge.message_ack,d)}),this.sendRequest(n,"wc_sessionDelete",$t("USER_DISCONNECTED"),void 0,o)]),await this.deleteSession(n)}else await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>q1(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,v;return((d=h.peerMetadata)==null?void 0:d.url)&&((v=h.peerMetadata)==null?void 0:v.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,$t("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i)},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,$t("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)])},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=ns.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d}=i;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d}),n&&this.client.core.expirer.set(o,gr(n))},this.sendRequest=async(i,n,o,h,d)=>{const v=dn(n,o);if(tl()&&Gb.includes(n)){const L=Ti(JSON.stringify(v));await this.client.core.verify.register({attestationId:L})}const w=await this.client.core.crypto.encode(i,v),P=ns[n].req;return h&&(P.ttl=h),d&&(P.id=d),this.client.core.history.set(i,v),this.client.core.relayer.publish(i,w,P),v.id},this.sendResult=async(i,n,o)=>{const h=ca(i,o),d=await this.client.core.crypto.encode(n,h),v=await this.client.core.history.get(n,i),w=ns[v.request.method].res;this.client.core.relayer.publish(n,d,w),await this.client.core.history.resolve(h)},this.sendError=async(i,n,o)=>{const h=gn(i,o),d=await this.client.core.crypto.encode(n,h),v=await this.client.core.history.get(n,i),w=ns[v.request.method].res;this.client.core.relayer.publish(n,d,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{Kr(o.expiry)&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Kr(o.expiry)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=W("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(ar({},n.params));const d=gr(ee.FIVE_MINUTES),v=ar({id:h,pairingTopic:i,expiry:d},o);await this.setProposal(h,v);const w=Ti(JSON.stringify(n)),P=await this.getVerifyContext(w,v.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:v,verifyContext:P})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(Dr(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const v=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const P=await this.client.core.crypto.generateSharedKey(v,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:P});const L=await this.client.core.relayer.subscribe(P);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:L}),await this.client.core.pairing.activate({topic:i})}else vr(n)&&(await this.client.proposal.delete(o,$t("USER_DISCONNECTED")),this.events.emit(tt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:v,expiry:w,namespaces:P,requiredNamespaces:L,optionalNamespaces:H,sessionProperties:K,pairingTopic:B}=n.params,F=ar({topic:i,relay:d,expiry:w,namespaces:P,acknowledged:!0,pairingTopic:B,requiredNamespaces:L,optionalNamespaces:H,controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},K&&{sessionProperties:K});await this.sendResult(n.id,i,!0),this.events.emit(tt("session_connect"),{session:F}),this.cleanupDuplicatePairings(F)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;Dr(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(tt("session_approve",o),{})):vr(n)&&(await this.client.session.delete(i,$t("USER_DISCONNECTED")),this.events.emit(tt("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidUpdate(ar({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult(h,i,!0),this.client.events.emit("session_update",{id:h,topic:i,params:o})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;Dr(n)?this.events.emit(tt("session_update",o),{}):vr(n)&&this.events.emit(tt("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,gr(en)),await this.sendResult(o,i,!0),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;Dr(n)?this.events.emit(tt("session_extend",o),{}):vr(n)&&this.events.emit(tt("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult(o,i,!0),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{Dr(n)?this.events.emit(tt("session_ping",o),{}):vr(n)&&this.events.emit(tt("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Ge.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult(o,i,!0)]),this.client.events.emit("session_delete",{id:o,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(ar({topic:i},h)),await this.setPendingSessionRequest({id:o,topic:i,params:h});const d=Ti(JSON.stringify(n)),v=this.client.session.get(i),w=await this.getVerifyContext(d,v.peer.metadata);this.client.events.emit("session_request",{id:o,topic:i,params:h,verifyContext:w})}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;Dr(n)?this.events.emit(tt("session_request",o),{result:n.result}):vr(n)&&this.events.emit(tt("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidEmit(ar({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h})}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.isValidConnect=async i=>{if(!kt(i)){const{message:w}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:v}=i;if(Gr(n)||await this.isValidPairingTopic(n),!U1(v,!0)){const{message:w}=W("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(w)}!Gr(o)&&nn(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Gr(h)&&nn(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Gr(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=z1(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!kt(i))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=i;await this.isValidProposalId(n);const v=this.client.proposal.get(n),w=Ro(o,"approve()");if(w)throw new Error(w.message);const P=Hu(v.requiredNamespaces,o,"approve()");if(P)throw new Error(P.message);if(!Ai(h,!0)){const{message:L}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(L)}Gr(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!kt(i)){const{message:h}=W("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!k1(o)){const{message:h}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!kt(i)){const{message:P}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(P)}const{relay:n,controller:o,namespaces:h,expiry:d}=i;if(!H1(n)){const{message:P}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(P)}const v=B1(o,"onSessionSettleRequest()");if(v)throw new Error(v.message);const w=Ro(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Kr(d)){const{message:P}=W("EXPIRED","onSessionSettleRequest()");throw new Error(P)}},this.isValidUpdate=async i=>{if(!kt(i)){const{message:w}=W("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=Ro(o,"update()");if(d)throw new Error(d.message);const v=Hu(h.requiredNamespaces,o,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async i=>{if(!kt(i)){const{message:o}=W("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!kt(i)){const{message:w}=W("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:o,chainId:h,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:v}=this.client.session.get(n);if(!Bu(v,h)){const{message:w}=W("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!V1(o)){const{message:w}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!K1(v,h,o.method)){const{message:w}=W("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(d&&!G1(d,zo)){const{message:w}=W("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${zo.min} and ${zo.max}`);throw new Error(w)}},this.isValidRespond=async i=>{if(!kt(i)){const{message:h}=W("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:n,response:o}=i;if(await this.isValidSessionTopic(n),!W1(o)){const{message:h}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!kt(i)){const{message:o}=W("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!kt(i)){const{message:v}=W("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(v)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!Bu(d,h)){const{message:v}=W("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(v)}if(!J1(o)){const{message:v}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}if(!Y1(d,h,o.name)){const{message:v}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}},this.isValidDisconnect=async i=>{if(!kt(i)){const{message:o}=W("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h,o.verified.validation=h===n.url?"VALID":"INVALID")}catch(h){this.client.logger.error(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!Ai(o,!1)){const{message:h}=W("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}isInitialized(){if(!this.initialized){const{message:r}=W("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.client.core.relayer.on(Ge.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);ua(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):vn(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})})}registerExpirerEvents(){this.client.core.expirer.on(cr.expired,async r=>{const{topic:i,id:n}=el(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,W("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(r){if(!Ai(r,!1)){const{message:i}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Kr(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=W("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!Ai(r,!1)){const{message:i}=W("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Kr(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=W("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(Ai(r,!1)){const{message:i}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!X1(r)){const{message:i}=W("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Kr(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=W("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class eE extends mn{constructor(r,i){super(r,i,Hb,fa),this.core=r,this.logger=i}}class tE extends mn{constructor(r,i){super(r,i,Bb,fa),this.core=r,this.logger=i}}class rE extends mn{constructor(r,i){super(r,i,Kb,fa,n=>n.id),this.core=r,this.logger=i}}let iE=class Kl extends Nm{constructor(r){super(r),this.protocol=kl,this.version=Hl,this.name=Uo.name,this.events=new Xt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||Uo.name,this.metadata=(r==null?void 0:r.metadata)||$1();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Uo.logger}));this.core=(r==null?void 0:r.core)||new zb(r),this.logger=Ee.generateChildLogger(i,this.name),this.session=new tE(this.core,this.logger),this.proposal=new eE(this.core,this.logger),this.pendingRequest=new rE(this.core,this.logger),this.engine=new Qb(this)}static async init(r){const i=new Kl(r);return await i.initialize(),i}get context(){return Ee.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var Yo={exports:{}};(function(c,r){var i=typeof self<"u"?self:Er,n=function(){function h(){this.fetch=!1,this.DOMException=i.DOMException}return h.prototype=i,new h}();(function(h){(function(d){var v={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function w(g){return g&&DataView.prototype.isPrototypeOf(g)}if(v.arrayBuffer)var P=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],L=ArrayBuffer.isView||function(g){return g&&P.indexOf(Object.prototype.toString.call(g))>-1};function H(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(g))throw new TypeError("Invalid character in header field name");return g.toLowerCase()}function K(g){return typeof g!="string"&&(g=String(g)),g}function B(g){var b={next:function(){var J=g.shift();return{done:J===void 0,value:J}}};return v.iterable&&(b[Symbol.iterator]=function(){return b}),b}function F(g){this.map={},g instanceof F?g.forEach(function(b,J){this.append(J,b)},this):Array.isArray(g)?g.forEach(function(b){this.append(b[0],b[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(b){this.append(b,g[b])},this)}F.prototype.append=function(g,b){g=H(g),b=K(b);var J=this.map[g];this.map[g]=J?J+", "+b:b},F.prototype.delete=function(g){delete this.map[H(g)]},F.prototype.get=function(g){return g=H(g),this.has(g)?this.map[g]:null},F.prototype.has=function(g){return this.map.hasOwnProperty(H(g))},F.prototype.set=function(g,b){this.map[H(g)]=K(b)},F.prototype.forEach=function(g,b){for(var J in this.map)this.map.hasOwnProperty(J)&&g.call(b,this.map[J],J,this)},F.prototype.keys=function(){var g=[];return this.forEach(function(b,J){g.push(J)}),B(g)},F.prototype.values=function(){var g=[];return this.forEach(function(b){g.push(b)}),B(g)},F.prototype.entries=function(){var g=[];return this.forEach(function(b,J){g.push([J,b])}),B(g)},v.iterable&&(F.prototype[Symbol.iterator]=F.prototype.entries);function V(g){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}function ie(g){return new Promise(function(b,J){g.onload=function(){b(g.result)},g.onerror=function(){J(g.error)}})}function ve(g){var b=new FileReader,J=ie(b);return b.readAsArrayBuffer(g),J}function we(g){var b=new FileReader,J=ie(b);return b.readAsText(g),J}function le(g){for(var b=new Uint8Array(g),J=new Array(b.length),se=0;se<b.length;se++)J[se]=String.fromCharCode(b[se]);return J.join("")}function oe(g){if(g.slice)return g.slice(0);var b=new Uint8Array(g.byteLength);return b.set(new Uint8Array(g)),b.buffer}function ce(){return this.bodyUsed=!1,this._initBody=function(g){this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:v.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:v.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:v.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():v.arrayBuffer&&v.blob&&w(g)?(this._bodyArrayBuffer=oe(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):v.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||L(g))?this._bodyArrayBuffer=oe(g):this._bodyText=g=Object.prototype.toString.call(g):this._bodyText="",this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob&&(this.blob=function(){var g=V(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?V(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ve)}),this.text=function(){var g=V(this);if(g)return g;if(this._bodyBlob)return we(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(le(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(fe)}),this.json=function(){return this.text().then(JSON.parse)},this}var A=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function j(g){var b=g.toUpperCase();return A.indexOf(b)>-1?b:g}function z(g,b){b=b||{};var J=b.body;if(g instanceof z){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,b.headers||(this.headers=new F(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!J&&g._bodyInit!=null&&(J=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new F(b.headers)),this.method=j(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&J)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(J)}z.prototype.clone=function(){return new z(this,{body:this._bodyInit})};function fe(g){var b=new FormData;return g.trim().split("&").forEach(function(J){if(J){var se=J.split("="),q=se.shift().replace(/\+/g," "),$=se.join("=").replace(/\+/g," ");b.append(decodeURIComponent(q),decodeURIComponent($))}}),b}function Z(g){var b=new F,J=g.replace(/\r?\n[\t ]+/g," ");return J.split(/\r?\n/).forEach(function(se){var q=se.split(":"),$=q.shift().trim();if($){var M=q.join(":").trim();b.append($,M)}}),b}ce.call(z.prototype);function ne(g,b){b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new F(b.headers),this.url=b.url||"",this._initBody(g)}ce.call(ne.prototype),ne.prototype.clone=function(){return new ne(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new F(this.headers),url:this.url})},ne.error=function(){var g=new ne(null,{status:0,statusText:""});return g.type="error",g};var Ce=[301,302,303,307,308];ne.redirect=function(g,b){if(Ce.indexOf(b)===-1)throw new RangeError("Invalid status code");return new ne(null,{status:b,headers:{location:g}})},d.DOMException=h.DOMException;try{new d.DOMException}catch{d.DOMException=function(b,J){this.message=b,this.name=J;var se=Error(b);this.stack=se.stack},d.DOMException.prototype=Object.create(Error.prototype),d.DOMException.prototype.constructor=d.DOMException}function De(g,b){return new Promise(function(J,se){var q=new z(g,b);if(q.signal&&q.signal.aborted)return se(new d.DOMException("Aborted","AbortError"));var $=new XMLHttpRequest;function M(){$.abort()}$.onload=function(){var U={status:$.status,statusText:$.statusText,headers:Z($.getAllResponseHeaders()||"")};U.url="responseURL"in $?$.responseURL:U.headers.get("X-Request-URL");var qe="response"in $?$.response:$.responseText;J(new ne(qe,U))},$.onerror=function(){se(new TypeError("Network request failed"))},$.ontimeout=function(){se(new TypeError("Network request failed"))},$.onabort=function(){se(new d.DOMException("Aborted","AbortError"))},$.open(q.method,q.url,!0),q.credentials==="include"?$.withCredentials=!0:q.credentials==="omit"&&($.withCredentials=!1),"responseType"in $&&v.blob&&($.responseType="blob"),q.headers.forEach(function(U,qe){$.setRequestHeader(qe,U)}),q.signal&&(q.signal.addEventListener("abort",M),$.onreadystatechange=function(){$.readyState===4&&q.signal.removeEventListener("abort",M)}),$.send(typeof q._bodyInit>"u"?null:q._bodyInit)})}return De.polyfill=!0,h.fetch||(h.fetch=De,h.Headers=F,h.Request=z,h.Response=ne),d.Headers=F,d.Request=z,d.Response=ne,d.fetch=De,Object.defineProperty(d,"__esModule",{value:!0}),d})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;r=o.fetch,r.default=o.fetch,r.fetch=o.fetch,r.Headers=o.Headers,r.Request=o.Request,r.Response=o.Response,c.exports=r})(Yo,Yo.exports);var sE=Yo.exports;const jh=Yh(sE),nE={Accept:"application/json","Content-Type":"application/json"},oE="POST",Mh={headers:nE,method:oE},qh=10;class li{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new Xt.EventEmitter,this.isAvailable=!1,this.registering=!1,!fh(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=us(r),h=await(await jh(this.url,Object.assign(Object.assign({},Mh),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!fh(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=us({id:1,jsonrpc:"2.0",method:"test",params:[]});await jh(r,Object.assign(Object.assign({},Mh),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?sa(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=gn(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return xl(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>qh&&this.events.setMaxListeners(qh)}}const Uh="error",aE="wss://relay.walletconnect.com",cE="wc",uE="universal_provider",zh=`${cE}@2:${uE}:`,hE="https://rpc.walletconnect.com/v1",Xr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Xo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(c,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",v="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",P=500,L="__lodash_placeholder__",H=1,K=2,B=4,F=1,V=2,ie=1,ve=2,we=4,le=8,oe=16,ce=32,A=64,j=128,z=256,fe=512,Z=30,ne="...",Ce=800,De=16,g=1,b=2,J=3,se=1/0,q=9007199254740991,$=17976931348623157e292,M=0/0,U=4294967295,qe=U-1,je=U>>>1,Fr=[["ary",j],["bind",ie],["bindKey",ve],["curry",le],["curryRight",oe],["flip",fe],["partial",ce],["partialRight",A],["rearg",z]],Ht="[object Arguments]",xt="[object Array]",C="[object AsyncFunction]",O="[object Boolean]",I="[object Date]",u="[object DOMException]",_="[object Error]",X="[object Function]",ue="[object GeneratorFunction]",ye="[object Map]",Pe="[object Number]",Oe="[object Null]",xe="[object Object]",at="[object Promise]",rt="[object Proxy]",We="[object RegExp]",Re="[object Set]",ze="[object String]",ke="[object Symbol]",Je="[object Undefined]",Fe="[object WeakMap]",He="[object WeakSet]",Ne="[object ArrayBuffer]",Be="[object DataView]",it="[object Float32Array]",ct="[object Float64Array]",It="[object Int8Array]",Ot="[object Int16Array]",Tt="[object Int32Array]",jt="[object Uint8Array]",Bt="[object Uint8ClampedArray]",Zt="[object Uint16Array]",hr="[object Uint32Array]",$r=/\b__p \+= '';/g,Zr=/\b(__p \+=) '' \+/g,fi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,pi=/&(?:amp|lt|gt|quot|#39);/g,Fi=/[&<>"']/g,ut=RegExp(pi.source),ht=RegExp(Fi.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,st=/<%=([\s\S]+?)%>/g,pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dt=/^\w*$/,gt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qe=/[\\^$.*+?()[\]{}|]/g,vt=RegExp(Qe.source),et=/^\s+/,yt=/\s/,mt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wt=/\{\n\/\* \[wrapped with (.+)\] \*/,_t=/,? & /,bt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Jl=/[()=,{}\[\]\/\s]/,Yl=/\\(\\)?/g,Xl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ga=/\w*$/,Zl=/^[-+]0x[0-9a-f]+$/i,Ql=/^0b[01]+$/i,ef=/^\[object .+?Constructor\]$/,tf=/^0o[0-7]+$/i,rf=/^(?:0|[1-9]\d*)$/,sf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fs=/($^)/,nf=/['\n\r\u2028\u2029\\]/g,ps="\\ud800-\\udfff",of="\\u0300-\\u036f",af="\\ufe20-\\ufe2f",cf="\\u20d0-\\u20ff",va=of+af+cf,ya="\\u2700-\\u27bf",ma="a-z\\xdf-\\xf6\\xf8-\\xff",uf="\\xac\\xb1\\xd7\\xf7",hf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",lf="\\u2000-\\u206f",ff=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wa="A-Z\\xc0-\\xd6\\xd8-\\xde",_a="\\ufe0e\\ufe0f",ba=uf+hf+lf+ff,wn="[']",pf="["+ps+"]",Ea="["+ba+"]",ds="["+va+"]",xa="\\d+",df="["+ya+"]",Ia="["+ma+"]",Pa="[^"+ps+ba+xa+ya+ma+wa+"]",_n="\\ud83c[\\udffb-\\udfff]",gf="(?:"+ds+"|"+_n+")",Sa="[^"+ps+"]",bn="(?:\\ud83c[\\udde6-\\uddff]){2}",En="[\\ud800-\\udbff][\\udc00-\\udfff]",di="["+wa+"]",Ca="\\u200d",Oa="(?:"+Ia+"|"+Pa+")",vf="(?:"+di+"|"+Pa+")",Aa="(?:"+wn+"(?:d|ll|m|re|s|t|ve))?",Ra="(?:"+wn+"(?:D|LL|M|RE|S|T|VE))?",Ta=gf+"?",Na="["+_a+"]?",yf="(?:"+Ca+"(?:"+[Sa,bn,En].join("|")+")"+Na+Ta+")*",mf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",wf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",La=Na+Ta+yf,_f="(?:"+[df,bn,En].join("|")+")"+La,bf="(?:"+[Sa+ds+"?",ds,bn,En,pf].join("|")+")",Ef=RegExp(wn,"g"),xf=RegExp(ds,"g"),xn=RegExp(_n+"(?="+_n+")|"+bf+La,"g"),If=RegExp([di+"?"+Ia+"+"+Aa+"(?="+[Ea,di,"$"].join("|")+")",vf+"+"+Ra+"(?="+[Ea,di+Oa,"$"].join("|")+")",di+"?"+Oa+"+"+Aa,di+"+"+Ra,wf,mf,xa,_f].join("|"),"g"),Pf=RegExp("["+Ca+ps+va+_a+"]"),Sf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Of=-1,Me={};Me[it]=Me[ct]=Me[It]=Me[Ot]=Me[Tt]=Me[jt]=Me[Bt]=Me[Zt]=Me[hr]=!0,Me[Ht]=Me[xt]=Me[Ne]=Me[O]=Me[Be]=Me[I]=Me[_]=Me[X]=Me[ye]=Me[Pe]=Me[xe]=Me[We]=Me[Re]=Me[ze]=Me[Fe]=!1;var $e={};$e[Ht]=$e[xt]=$e[Ne]=$e[Be]=$e[O]=$e[I]=$e[it]=$e[ct]=$e[It]=$e[Ot]=$e[Tt]=$e[ye]=$e[Pe]=$e[xe]=$e[We]=$e[Re]=$e[ze]=$e[ke]=$e[jt]=$e[Bt]=$e[Zt]=$e[hr]=!0,$e[_]=$e[X]=$e[Fe]=!1;var Af={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Rf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Nf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Lf=parseFloat,Df=parseInt,Da=typeof os=="object"&&os&&os.Object===Object&&os,Ff=typeof self=="object"&&self&&self.Object===Object&&self,Pt=Da||Ff||Function("return this")(),In=r&&!r.nodeType&&r,Qr=In&&!0&&c&&!c.nodeType&&c,Fa=Qr&&Qr.exports===In,Pn=Fa&&Da.process,Qt=function(){try{var E=Qr&&Qr.require&&Qr.require("util").types;return E||Pn&&Pn.binding&&Pn.binding("util")}catch{}}(),$a=Qt&&Qt.isArrayBuffer,ja=Qt&&Qt.isDate,Ma=Qt&&Qt.isMap,qa=Qt&&Qt.isRegExp,Ua=Qt&&Qt.isSet,za=Qt&&Qt.isTypedArray;function Vt(E,R,S){switch(S.length){case 0:return E.call(R);case 1:return E.call(R,S[0]);case 2:return E.call(R,S[0],S[1]);case 3:return E.call(R,S[0],S[1],S[2])}return E.apply(R,S)}function $f(E,R,S,G){for(var ae=-1,Ie=E==null?0:E.length;++ae<Ie;){var nt=E[ae];R(G,nt,S(nt),E)}return G}function er(E,R){for(var S=-1,G=E==null?0:E.length;++S<G&&R(E[S],S,E)!==!1;);return E}function jf(E,R){for(var S=E==null?0:E.length;S--&&R(E[S],S,E)!==!1;);return E}function ka(E,R){for(var S=-1,G=E==null?0:E.length;++S<G;)if(!R(E[S],S,E))return!1;return!0}function jr(E,R){for(var S=-1,G=E==null?0:E.length,ae=0,Ie=[];++S<G;){var nt=E[S];R(nt,S,E)&&(Ie[ae++]=nt)}return Ie}function gs(E,R){var S=E==null?0:E.length;return!!S&&gi(E,R,0)>-1}function Sn(E,R,S){for(var G=-1,ae=E==null?0:E.length;++G<ae;)if(S(R,E[G]))return!0;return!1}function Ue(E,R){for(var S=-1,G=E==null?0:E.length,ae=Array(G);++S<G;)ae[S]=R(E[S],S,E);return ae}function Mr(E,R){for(var S=-1,G=R.length,ae=E.length;++S<G;)E[ae+S]=R[S];return E}function Cn(E,R,S,G){var ae=-1,Ie=E==null?0:E.length;for(G&&Ie&&(S=E[++ae]);++ae<Ie;)S=R(S,E[ae],ae,E);return S}function Mf(E,R,S,G){var ae=E==null?0:E.length;for(G&&ae&&(S=E[--ae]);ae--;)S=R(S,E[ae],ae,E);return S}function On(E,R){for(var S=-1,G=E==null?0:E.length;++S<G;)if(R(E[S],S,E))return!0;return!1}var qf=An("length");function Uf(E){return E.split("")}function zf(E){return E.match(bt)||[]}function Ha(E,R,S){var G;return S(E,function(ae,Ie,nt){if(R(ae,Ie,nt))return G=Ie,!1}),G}function vs(E,R,S,G){for(var ae=E.length,Ie=S+(G?1:-1);G?Ie--:++Ie<ae;)if(R(E[Ie],Ie,E))return Ie;return-1}function gi(E,R,S){return R===R?Qf(E,R,S):vs(E,Ba,S)}function kf(E,R,S,G){for(var ae=S-1,Ie=E.length;++ae<Ie;)if(G(E[ae],R))return ae;return-1}function Ba(E){return E!==E}function Va(E,R){var S=E==null?0:E.length;return S?Tn(E,R)/S:M}function An(E){return function(R){return R==null?i:R[E]}}function Rn(E){return function(R){return E==null?i:E[R]}}function Ka(E,R,S,G,ae){return ae(E,function(Ie,nt,Le){S=G?(G=!1,Ie):R(S,Ie,nt,Le)}),S}function Hf(E,R){var S=E.length;for(E.sort(R);S--;)E[S]=E[S].value;return E}function Tn(E,R){for(var S,G=-1,ae=E.length;++G<ae;){var Ie=R(E[G]);Ie!==i&&(S=S===i?Ie:S+Ie)}return S}function Nn(E,R){for(var S=-1,G=Array(E);++S<E;)G[S]=R(S);return G}function Bf(E,R){return Ue(R,function(S){return[S,E[S]]})}function Ga(E){return E&&E.slice(0,Xa(E)+1).replace(et,"")}function Kt(E){return function(R){return E(R)}}function Ln(E,R){return Ue(R,function(S){return E[S]})}function $i(E,R){return E.has(R)}function Wa(E,R){for(var S=-1,G=E.length;++S<G&&gi(R,E[S],0)>-1;);return S}function Ja(E,R){for(var S=E.length;S--&&gi(R,E[S],0)>-1;);return S}function Vf(E,R){for(var S=E.length,G=0;S--;)E[S]===R&&++G;return G}var Kf=Rn(Af),Gf=Rn(Rf);function Wf(E){return"\\"+Nf[E]}function Jf(E,R){return E==null?i:E[R]}function vi(E){return Pf.test(E)}function Yf(E){return Sf.test(E)}function Xf(E){for(var R,S=[];!(R=E.next()).done;)S.push(R.value);return S}function Dn(E){var R=-1,S=Array(E.size);return E.forEach(function(G,ae){S[++R]=[ae,G]}),S}function Ya(E,R){return function(S){return E(R(S))}}function qr(E,R){for(var S=-1,G=E.length,ae=0,Ie=[];++S<G;){var nt=E[S];(nt===R||nt===L)&&(E[S]=L,Ie[ae++]=S)}return Ie}function ys(E){var R=-1,S=Array(E.size);return E.forEach(function(G){S[++R]=G}),S}function Zf(E){var R=-1,S=Array(E.size);return E.forEach(function(G){S[++R]=[G,G]}),S}function Qf(E,R,S){for(var G=S-1,ae=E.length;++G<ae;)if(E[G]===R)return G;return-1}function ep(E,R,S){for(var G=S+1;G--;)if(E[G]===R)return G;return G}function yi(E){return vi(E)?rp(E):qf(E)}function lr(E){return vi(E)?ip(E):Uf(E)}function Xa(E){for(var R=E.length;R--&&yt.test(E.charAt(R)););return R}var tp=Rn(Tf);function rp(E){for(var R=xn.lastIndex=0;xn.test(E);)++R;return R}function ip(E){return E.match(xn)||[]}function sp(E){return E.match(If)||[]}var np=function E(R){R=R==null?Pt:mi.defaults(Pt.Object(),R,mi.pick(Pt,Cf));var S=R.Array,G=R.Date,ae=R.Error,Ie=R.Function,nt=R.Math,Le=R.Object,Fn=R.RegExp,op=R.String,tr=R.TypeError,ms=S.prototype,ap=Ie.prototype,wi=Le.prototype,ws=R["__core-js_shared__"],_s=ap.toString,Ae=wi.hasOwnProperty,cp=0,Za=function(){var e=/[^.]+$/.exec(ws&&ws.keys&&ws.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),bs=wi.toString,up=_s.call(Le),hp=Pt._,lp=Fn("^"+_s.call(Ae).replace(Qe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Es=Fa?R.Buffer:i,Ur=R.Symbol,xs=R.Uint8Array,Qa=Es?Es.allocUnsafe:i,Is=Ya(Le.getPrototypeOf,Le),ec=Le.create,tc=wi.propertyIsEnumerable,Ps=ms.splice,rc=Ur?Ur.isConcatSpreadable:i,ji=Ur?Ur.iterator:i,ei=Ur?Ur.toStringTag:i,Ss=function(){try{var e=ni(Le,"defineProperty");return e({},"",{}),e}catch{}}(),fp=R.clearTimeout!==Pt.clearTimeout&&R.clearTimeout,pp=G&&G.now!==Pt.Date.now&&G.now,dp=R.setTimeout!==Pt.setTimeout&&R.setTimeout,Cs=nt.ceil,Os=nt.floor,$n=Le.getOwnPropertySymbols,gp=Es?Es.isBuffer:i,ic=R.isFinite,vp=ms.join,yp=Ya(Le.keys,Le),ot=nt.max,At=nt.min,mp=G.now,wp=R.parseInt,sc=nt.random,_p=ms.reverse,jn=ni(R,"DataView"),Mi=ni(R,"Map"),Mn=ni(R,"Promise"),_i=ni(R,"Set"),qi=ni(R,"WeakMap"),Ui=ni(Le,"create"),As=qi&&new qi,bi={},bp=oi(jn),Ep=oi(Mi),xp=oi(Mn),Ip=oi(_i),Pp=oi(qi),Rs=Ur?Ur.prototype:i,zi=Rs?Rs.valueOf:i,nc=Rs?Rs.toString:i;function f(e){if(Ke(e)&&!he(e)&&!(e instanceof _e)){if(e instanceof rr)return e;if(Ae.call(e,"__wrapped__"))return ou(e)}return new rr(e)}var Ei=function(){function e(){}return function(t){if(!Ve(t))return{};if(ec)return ec(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function Ts(){}function rr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}f.templateSettings={escape:lt,evaluate:ft,interpolate:st,variable:"",imports:{_:f}},f.prototype=Ts.prototype,f.prototype.constructor=f,rr.prototype=Ei(Ts.prototype),rr.prototype.constructor=rr;function _e(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=U,this.__views__=[]}function Sp(){var e=new _e(this.__wrapped__);return e.__actions__=Mt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Mt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Mt(this.__views__),e}function Cp(){if(this.__filtered__){var e=new _e(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Op(){var e=this.__wrapped__.value(),t=this.__dir__,s=he(e),a=t<0,l=s?e.length:0,p=Ud(0,l,this.__views__),y=p.start,m=p.end,x=m-y,T=a?m:y-1,N=this.__iteratees__,D=N.length,k=0,Y=At(x,this.__takeCount__);if(!s||!a&&l==x&&Y==x)return Ac(e,this.__actions__);var te=[];e:for(;x--&&k<Y;){T+=t;for(var de=-1,re=e[T];++de<D;){var me=N[de],be=me.iteratee,Jt=me.type,Dt=be(re);if(Jt==b)re=Dt;else if(!Dt){if(Jt==g)continue e;break e}}te[k++]=re}return te}_e.prototype=Ei(Ts.prototype),_e.prototype.constructor=_e;function ti(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Ap(){this.__data__=Ui?Ui(null):{},this.size=0}function Rp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Tp(e){var t=this.__data__;if(Ui){var s=t[e];return s===w?i:s}return Ae.call(t,e)?t[e]:i}function Np(e){var t=this.__data__;return Ui?t[e]!==i:Ae.call(t,e)}function Lp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Ui&&t===i?w:t,this}ti.prototype.clear=Ap,ti.prototype.delete=Rp,ti.prototype.get=Tp,ti.prototype.has=Np,ti.prototype.set=Lp;function xr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Dp(){this.__data__=[],this.size=0}function Fp(e){var t=this.__data__,s=Ns(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Ps.call(t,s,1),--this.size,!0}function $p(e){var t=this.__data__,s=Ns(t,e);return s<0?i:t[s][1]}function jp(e){return Ns(this.__data__,e)>-1}function Mp(e,t){var s=this.__data__,a=Ns(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}xr.prototype.clear=Dp,xr.prototype.delete=Fp,xr.prototype.get=$p,xr.prototype.has=jp,xr.prototype.set=Mp;function Ir(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function qp(){this.size=0,this.__data__={hash:new ti,map:new(Mi||xr),string:new ti}}function Up(e){var t=Bs(this,e).delete(e);return this.size-=t?1:0,t}function zp(e){return Bs(this,e).get(e)}function kp(e){return Bs(this,e).has(e)}function Hp(e,t){var s=Bs(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Ir.prototype.clear=qp,Ir.prototype.delete=Up,Ir.prototype.get=zp,Ir.prototype.has=kp,Ir.prototype.set=Hp;function ri(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Ir;++t<s;)this.add(e[t])}function Bp(e){return this.__data__.set(e,w),this}function Vp(e){return this.__data__.has(e)}ri.prototype.add=ri.prototype.push=Bp,ri.prototype.has=Vp;function fr(e){var t=this.__data__=new xr(e);this.size=t.size}function Kp(){this.__data__=new xr,this.size=0}function Gp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function Wp(e){return this.__data__.get(e)}function Jp(e){return this.__data__.has(e)}function Yp(e,t){var s=this.__data__;if(s instanceof xr){var a=s.__data__;if(!Mi||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Ir(a)}return s.set(e,t),this.size=s.size,this}fr.prototype.clear=Kp,fr.prototype.delete=Gp,fr.prototype.get=Wp,fr.prototype.has=Jp,fr.prototype.set=Yp;function oc(e,t){var s=he(e),a=!s&&ai(e),l=!s&&!a&&Vr(e),p=!s&&!a&&!l&&Si(e),y=s||a||l||p,m=y?Nn(e.length,op):[],x=m.length;for(var T in e)(t||Ae.call(e,T))&&!(y&&(T=="length"||l&&(T=="offset"||T=="parent")||p&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||Or(T,x)))&&m.push(T);return m}function ac(e){var t=e.length;return t?e[Jn(0,t-1)]:i}function Xp(e,t){return Vs(Mt(e),ii(t,0,e.length))}function Zp(e){return Vs(Mt(e))}function qn(e,t,s){(s!==i&&!pr(e[t],s)||s===i&&!(t in e))&&Pr(e,t,s)}function ki(e,t,s){var a=e[t];(!(Ae.call(e,t)&&pr(a,s))||s===i&&!(t in e))&&Pr(e,t,s)}function Ns(e,t){for(var s=e.length;s--;)if(pr(e[s][0],t))return s;return-1}function Qp(e,t,s,a){return zr(e,function(l,p,y){t(a,l,s(l),y)}),a}function cc(e,t){return e&&mr(t,Et(t),e)}function ed(e,t){return e&&mr(t,Ut(t),e)}function Pr(e,t,s){t=="__proto__"&&Ss?Ss(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Un(e,t){for(var s=-1,a=t.length,l=S(a),p=e==null;++s<a;)l[s]=p?i:bo(e,t[s]);return l}function ii(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function ir(e,t,s,a,l,p){var y,m=t&H,x=t&K,T=t&B;if(s&&(y=l?s(e,a,l,p):s(e)),y!==i)return y;if(!Ve(e))return e;var N=he(e);if(N){if(y=kd(e),!m)return Mt(e,y)}else{var D=Rt(e),k=D==X||D==ue;if(Vr(e))return Nc(e,m);if(D==xe||D==Ht||k&&!l){if(y=x||k?{}:Xc(e),!m)return x?Td(e,ed(y,e)):Rd(e,cc(y,e))}else{if(!$e[D])return l?e:{};y=Hd(e,D,m)}}p||(p=new fr);var Y=p.get(e);if(Y)return Y;p.set(e,y),Su(e)?e.forEach(function(re){y.add(ir(re,t,s,re,e,p))}):Iu(e)&&e.forEach(function(re,me){y.set(me,ir(re,t,s,me,e,p))});var te=T?x?oo:no:x?Ut:Et,de=N?i:te(e);return er(de||e,function(re,me){de&&(me=re,re=e[me]),ki(y,me,ir(re,t,s,me,e,p))}),y}function td(e){var t=Et(e);return function(s){return uc(s,e,t)}}function uc(e,t,s){var a=s.length;if(e==null)return!a;for(e=Le(e);a--;){var l=s[a],p=t[l],y=e[l];if(y===i&&!(l in e)||!p(y))return!1}return!0}function hc(e,t,s){if(typeof e!="function")throw new tr(d);return Ji(function(){e.apply(i,s)},t)}function Hi(e,t,s,a){var l=-1,p=gs,y=!0,m=e.length,x=[],T=t.length;if(!m)return x;s&&(t=Ue(t,Kt(s))),a?(p=Sn,y=!1):t.length>=o&&(p=$i,y=!1,t=new ri(t));e:for(;++l<m;){var N=e[l],D=s==null?N:s(N);if(N=a||N!==0?N:0,y&&D===D){for(var k=T;k--;)if(t[k]===D)continue e;x.push(N)}else p(t,D,a)||x.push(N)}return x}var zr=jc(yr),lc=jc(kn,!0);function rd(e,t){var s=!0;return zr(e,function(a,l,p){return s=!!t(a,l,p),s}),s}function Ls(e,t,s){for(var a=-1,l=e.length;++a<l;){var p=e[a],y=t(p);if(y!=null&&(m===i?y===y&&!Wt(y):s(y,m)))var m=y,x=p}return x}function id(e,t,s,a){var l=e.length;for(s=pe(s),s<0&&(s=-s>l?0:l+s),a=a===i||a>l?l:pe(a),a<0&&(a+=l),a=s>a?0:Ou(a);s<a;)e[s++]=t;return e}function fc(e,t){var s=[];return zr(e,function(a,l,p){t(a,l,p)&&s.push(a)}),s}function St(e,t,s,a,l){var p=-1,y=e.length;for(s||(s=Vd),l||(l=[]);++p<y;){var m=e[p];t>0&&s(m)?t>1?St(m,t-1,s,a,l):Mr(l,m):a||(l[l.length]=m)}return l}var zn=Mc(),pc=Mc(!0);function yr(e,t){return e&&zn(e,t,Et)}function kn(e,t){return e&&pc(e,t,Et)}function Ds(e,t){return jr(t,function(s){return Ar(e[s])})}function si(e,t){t=Hr(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[wr(t[s++])];return s&&s==a?e:i}function dc(e,t,s){var a=t(e);return he(e)?a:Mr(a,s(e))}function Nt(e){return e==null?e===i?Je:Oe:ei&&ei in Le(e)?qd(e):Zd(e)}function Hn(e,t){return e>t}function sd(e,t){return e!=null&&Ae.call(e,t)}function nd(e,t){return e!=null&&t in Le(e)}function od(e,t,s){return e>=At(t,s)&&e<ot(t,s)}function Bn(e,t,s){for(var a=s?Sn:gs,l=e[0].length,p=e.length,y=p,m=S(p),x=1/0,T=[];y--;){var N=e[y];y&&t&&(N=Ue(N,Kt(t))),x=At(N.length,x),m[y]=!s&&(t||l>=120&&N.length>=120)?new ri(y&&N):i}N=e[0];var D=-1,k=m[0];e:for(;++D<l&&T.length<x;){var Y=N[D],te=t?t(Y):Y;if(Y=s||Y!==0?Y:0,!(k?$i(k,te):a(T,te,s))){for(y=p;--y;){var de=m[y];if(!(de?$i(de,te):a(e[y],te,s)))continue e}k&&k.push(te),T.push(Y)}}return T}function ad(e,t,s,a){return yr(e,function(l,p,y){t(a,s(l),p,y)}),a}function Bi(e,t,s){t=Hr(t,e),e=tu(e,t);var a=e==null?e:e[wr(nr(t))];return a==null?i:Vt(a,e,s)}function gc(e){return Ke(e)&&Nt(e)==Ht}function cd(e){return Ke(e)&&Nt(e)==Ne}function ud(e){return Ke(e)&&Nt(e)==I}function Vi(e,t,s,a,l){return e===t?!0:e==null||t==null||!Ke(e)&&!Ke(t)?e!==e&&t!==t:hd(e,t,s,a,Vi,l)}function hd(e,t,s,a,l,p){var y=he(e),m=he(t),x=y?xt:Rt(e),T=m?xt:Rt(t);x=x==Ht?xe:x,T=T==Ht?xe:T;var N=x==xe,D=T==xe,k=x==T;if(k&&Vr(e)){if(!Vr(t))return!1;y=!0,N=!1}if(k&&!N)return p||(p=new fr),y||Si(e)?Wc(e,t,s,a,l,p):jd(e,t,x,s,a,l,p);if(!(s&F)){var Y=N&&Ae.call(e,"__wrapped__"),te=D&&Ae.call(t,"__wrapped__");if(Y||te){var de=Y?e.value():e,re=te?t.value():t;return p||(p=new fr),l(de,re,s,a,p)}}return k?(p||(p=new fr),Md(e,t,s,a,l,p)):!1}function ld(e){return Ke(e)&&Rt(e)==ye}function Vn(e,t,s,a){var l=s.length,p=l,y=!a;if(e==null)return!p;for(e=Le(e);l--;){var m=s[l];if(y&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++l<p;){m=s[l];var x=m[0],T=e[x],N=m[1];if(y&&m[2]){if(T===i&&!(x in e))return!1}else{var D=new fr;if(a)var k=a(T,N,x,e,t,D);if(!(k===i?Vi(N,T,F|V,a,D):k))return!1}}return!0}function vc(e){if(!Ve(e)||Gd(e))return!1;var t=Ar(e)?lp:ef;return t.test(oi(e))}function fd(e){return Ke(e)&&Nt(e)==We}function pd(e){return Ke(e)&&Rt(e)==Re}function dd(e){return Ke(e)&&Xs(e.length)&&!!Me[Nt(e)]}function yc(e){return typeof e=="function"?e:e==null?zt:typeof e=="object"?he(e)?_c(e[0],e[1]):wc(e):qu(e)}function Kn(e){if(!Wi(e))return yp(e);var t=[];for(var s in Le(e))Ae.call(e,s)&&s!="constructor"&&t.push(s);return t}function gd(e){if(!Ve(e))return Xd(e);var t=Wi(e),s=[];for(var a in e)a=="constructor"&&(t||!Ae.call(e,a))||s.push(a);return s}function Gn(e,t){return e<t}function mc(e,t){var s=-1,a=qt(e)?S(e.length):[];return zr(e,function(l,p,y){a[++s]=t(l,p,y)}),a}function wc(e){var t=co(e);return t.length==1&&t[0][2]?Qc(t[0][0],t[0][1]):function(s){return s===e||Vn(s,e,t)}}function _c(e,t){return ho(e)&&Zc(t)?Qc(wr(e),t):function(s){var a=bo(s,e);return a===i&&a===t?Eo(s,e):Vi(t,a,F|V)}}function Fs(e,t,s,a,l){e!==t&&zn(t,function(p,y){if(l||(l=new fr),Ve(p))vd(e,t,y,s,Fs,a,l);else{var m=a?a(fo(e,y),p,y+"",e,t,l):i;m===i&&(m=p),qn(e,y,m)}},Ut)}function vd(e,t,s,a,l,p,y){var m=fo(e,s),x=fo(t,s),T=y.get(x);if(T){qn(e,s,T);return}var N=p?p(m,x,s+"",e,t,y):i,D=N===i;if(D){var k=he(x),Y=!k&&Vr(x),te=!k&&!Y&&Si(x);N=x,k||Y||te?he(m)?N=m:Ye(m)?N=Mt(m):Y?(D=!1,N=Nc(x,!0)):te?(D=!1,N=Lc(x,!0)):N=[]:Yi(x)||ai(x)?(N=m,ai(m)?N=Au(m):(!Ve(m)||Ar(m))&&(N=Xc(x))):D=!1}D&&(y.set(x,N),l(N,x,a,p,y),y.delete(x)),qn(e,s,N)}function bc(e,t){var s=e.length;if(s)return t+=t<0?s:0,Or(t,s)?e[t]:i}function Ec(e,t,s){t.length?t=Ue(t,function(p){return he(p)?function(y){return si(y,p.length===1?p[0]:p)}:p}):t=[zt];var a=-1;t=Ue(t,Kt(Q()));var l=mc(e,function(p,y,m){var x=Ue(t,function(T){return T(p)});return{criteria:x,index:++a,value:p}});return Hf(l,function(p,y){return Ad(p,y,s)})}function yd(e,t){return xc(e,t,function(s,a){return Eo(e,a)})}function xc(e,t,s){for(var a=-1,l=t.length,p={};++a<l;){var y=t[a],m=si(e,y);s(m,y)&&Ki(p,Hr(y,e),m)}return p}function md(e){return function(t){return si(t,e)}}function Wn(e,t,s,a){var l=a?kf:gi,p=-1,y=t.length,m=e;for(e===t&&(t=Mt(t)),s&&(m=Ue(e,Kt(s)));++p<y;)for(var x=0,T=t[p],N=s?s(T):T;(x=l(m,N,x,a))>-1;)m!==e&&Ps.call(m,x,1),Ps.call(e,x,1);return e}function Ic(e,t){for(var s=e?t.length:0,a=s-1;s--;){var l=t[s];if(s==a||l!==p){var p=l;Or(l)?Ps.call(e,l,1):Zn(e,l)}}return e}function Jn(e,t){return e+Os(sc()*(t-e+1))}function wd(e,t,s,a){for(var l=-1,p=ot(Cs((t-e)/(s||1)),0),y=S(p);p--;)y[a?p:++l]=e,e+=s;return y}function Yn(e,t){var s="";if(!e||t<1||t>q)return s;do t%2&&(s+=e),t=Os(t/2),t&&(e+=e);while(t);return s}function ge(e,t){return po(eu(e,t,zt),e+"")}function _d(e){return ac(Ci(e))}function bd(e,t){var s=Ci(e);return Vs(s,ii(t,0,s.length))}function Ki(e,t,s,a){if(!Ve(e))return e;t=Hr(t,e);for(var l=-1,p=t.length,y=p-1,m=e;m!=null&&++l<p;){var x=wr(t[l]),T=s;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(l!=y){var N=m[x];T=a?a(N,x,m):i,T===i&&(T=Ve(N)?N:Or(t[l+1])?[]:{})}ki(m,x,T),m=m[x]}return e}var Pc=As?function(e,t){return As.set(e,t),e}:zt,Ed=Ss?function(e,t){return Ss(e,"toString",{configurable:!0,enumerable:!1,value:Io(t),writable:!0})}:zt;function xd(e){return Vs(Ci(e))}function sr(e,t,s){var a=-1,l=e.length;t<0&&(t=-t>l?0:l+t),s=s>l?l:s,s<0&&(s+=l),l=t>s?0:s-t>>>0,t>>>=0;for(var p=S(l);++a<l;)p[a]=e[a+t];return p}function Id(e,t){var s;return zr(e,function(a,l,p){return s=t(a,l,p),!s}),!!s}function $s(e,t,s){var a=0,l=e==null?a:e.length;if(typeof t=="number"&&t===t&&l<=je){for(;a<l;){var p=a+l>>>1,y=e[p];y!==null&&!Wt(y)&&(s?y<=t:y<t)?a=p+1:l=p}return l}return Xn(e,t,zt,s)}function Xn(e,t,s,a){var l=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var y=t!==t,m=t===null,x=Wt(t),T=t===i;l<p;){var N=Os((l+p)/2),D=s(e[N]),k=D!==i,Y=D===null,te=D===D,de=Wt(D);if(y)var re=a||te;else T?re=te&&(a||k):m?re=te&&k&&(a||!Y):x?re=te&&k&&!Y&&(a||!de):Y||de?re=!1:re=a?D<=t:D<t;re?l=N+1:p=N}return At(p,qe)}function Sc(e,t){for(var s=-1,a=e.length,l=0,p=[];++s<a;){var y=e[s],m=t?t(y):y;if(!s||!pr(m,x)){var x=m;p[l++]=y===0?0:y}}return p}function Cc(e){return typeof e=="number"?e:Wt(e)?M:+e}function Gt(e){if(typeof e=="string")return e;if(he(e))return Ue(e,Gt)+"";if(Wt(e))return nc?nc.call(e):"";var t=e+"";return t=="0"&&1/e==-se?"-0":t}function kr(e,t,s){var a=-1,l=gs,p=e.length,y=!0,m=[],x=m;if(s)y=!1,l=Sn;else if(p>=o){var T=t?null:Fd(e);if(T)return ys(T);y=!1,l=$i,x=new ri}else x=t?[]:m;e:for(;++a<p;){var N=e[a],D=t?t(N):N;if(N=s||N!==0?N:0,y&&D===D){for(var k=x.length;k--;)if(x[k]===D)continue e;t&&x.push(D),m.push(N)}else l(x,D,s)||(x!==m&&x.push(D),m.push(N))}return m}function Zn(e,t){return t=Hr(t,e),e=tu(e,t),e==null||delete e[wr(nr(t))]}function Oc(e,t,s,a){return Ki(e,t,s(si(e,t)),a)}function js(e,t,s,a){for(var l=e.length,p=a?l:-1;(a?p--:++p<l)&&t(e[p],p,e););return s?sr(e,a?0:p,a?p+1:l):sr(e,a?p+1:0,a?l:p)}function Ac(e,t){var s=e;return s instanceof _e&&(s=s.value()),Cn(t,function(a,l){return l.func.apply(l.thisArg,Mr([a],l.args))},s)}function Qn(e,t,s){var a=e.length;if(a<2)return a?kr(e[0]):[];for(var l=-1,p=S(a);++l<a;)for(var y=e[l],m=-1;++m<a;)m!=l&&(p[l]=Hi(p[l]||y,e[m],t,s));return kr(St(p,1),t,s)}function Rc(e,t,s){for(var a=-1,l=e.length,p=t.length,y={};++a<l;){var m=a<p?t[a]:i;s(y,e[a],m)}return y}function eo(e){return Ye(e)?e:[]}function to(e){return typeof e=="function"?e:zt}function Hr(e,t){return he(e)?e:ho(e,t)?[e]:nu(Se(e))}var Pd=ge;function Br(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:sr(e,t,s)}var Tc=fp||function(e){return Pt.clearTimeout(e)};function Nc(e,t){if(t)return e.slice();var s=e.length,a=Qa?Qa(s):new e.constructor(s);return e.copy(a),a}function ro(e){var t=new e.constructor(e.byteLength);return new xs(t).set(new xs(e)),t}function Sd(e,t){var s=t?ro(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Cd(e){var t=new e.constructor(e.source,ga.exec(e));return t.lastIndex=e.lastIndex,t}function Od(e){return zi?Le(zi.call(e)):{}}function Lc(e,t){var s=t?ro(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Dc(e,t){if(e!==t){var s=e!==i,a=e===null,l=e===e,p=Wt(e),y=t!==i,m=t===null,x=t===t,T=Wt(t);if(!m&&!T&&!p&&e>t||p&&y&&x&&!m&&!T||a&&y&&x||!s&&x||!l)return 1;if(!a&&!p&&!T&&e<t||T&&s&&l&&!a&&!p||m&&s&&l||!y&&l||!x)return-1}return 0}function Ad(e,t,s){for(var a=-1,l=e.criteria,p=t.criteria,y=l.length,m=s.length;++a<y;){var x=Dc(l[a],p[a]);if(x){if(a>=m)return x;var T=s[a];return x*(T=="desc"?-1:1)}}return e.index-t.index}function Fc(e,t,s,a){for(var l=-1,p=e.length,y=s.length,m=-1,x=t.length,T=ot(p-y,0),N=S(x+T),D=!a;++m<x;)N[m]=t[m];for(;++l<y;)(D||l<p)&&(N[s[l]]=e[l]);for(;T--;)N[m++]=e[l++];return N}function $c(e,t,s,a){for(var l=-1,p=e.length,y=-1,m=s.length,x=-1,T=t.length,N=ot(p-m,0),D=S(N+T),k=!a;++l<N;)D[l]=e[l];for(var Y=l;++x<T;)D[Y+x]=t[x];for(;++y<m;)(k||l<p)&&(D[Y+s[y]]=e[l++]);return D}function Mt(e,t){var s=-1,a=e.length;for(t||(t=S(a));++s<a;)t[s]=e[s];return t}function mr(e,t,s,a){var l=!s;s||(s={});for(var p=-1,y=t.length;++p<y;){var m=t[p],x=a?a(s[m],e[m],m,s,e):i;x===i&&(x=e[m]),l?Pr(s,m,x):ki(s,m,x)}return s}function Rd(e,t){return mr(e,uo(e),t)}function Td(e,t){return mr(e,Jc(e),t)}function Ms(e,t){return function(s,a){var l=he(s)?$f:Qp,p=t?t():{};return l(s,e,Q(a,2),p)}}function xi(e){return ge(function(t,s){var a=-1,l=s.length,p=l>1?s[l-1]:i,y=l>2?s[2]:i;for(p=e.length>3&&typeof p=="function"?(l--,p):i,y&&Lt(s[0],s[1],y)&&(p=l<3?i:p,l=1),t=Le(t);++a<l;){var m=s[a];m&&e(t,m,a,p)}return t})}function jc(e,t){return function(s,a){if(s==null)return s;if(!qt(s))return e(s,a);for(var l=s.length,p=t?l:-1,y=Le(s);(t?p--:++p<l)&&a(y[p],p,y)!==!1;);return s}}function Mc(e){return function(t,s,a){for(var l=-1,p=Le(t),y=a(t),m=y.length;m--;){var x=y[e?m:++l];if(s(p[x],x,p)===!1)break}return t}}function Nd(e,t,s){var a=t&ie,l=Gi(e);function p(){var y=this&&this!==Pt&&this instanceof p?l:e;return y.apply(a?s:this,arguments)}return p}function qc(e){return function(t){t=Se(t);var s=vi(t)?lr(t):i,a=s?s[0]:t.charAt(0),l=s?Br(s,1).join(""):t.slice(1);return a[e]()+l}}function Ii(e){return function(t){return Cn(ju($u(t).replace(Ef,"")),e,"")}}function Gi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=Ei(e.prototype),a=e.apply(s,t);return Ve(a)?a:s}}function Ld(e,t,s){var a=Gi(e);function l(){for(var p=arguments.length,y=S(p),m=p,x=Pi(l);m--;)y[m]=arguments[m];var T=p<3&&y[0]!==x&&y[p-1]!==x?[]:qr(y,x);if(p-=T.length,p<s)return Bc(e,t,qs,l.placeholder,i,y,T,i,i,s-p);var N=this&&this!==Pt&&this instanceof l?a:e;return Vt(N,this,y)}return l}function Uc(e){return function(t,s,a){var l=Le(t);if(!qt(t)){var p=Q(s,3);t=Et(t),s=function(m){return p(l[m],m,l)}}var y=e(t,s,a);return y>-1?l[p?t[y]:y]:i}}function zc(e){return Cr(function(t){var s=t.length,a=s,l=rr.prototype.thru;for(e&&t.reverse();a--;){var p=t[a];if(typeof p!="function")throw new tr(d);if(l&&!y&&Hs(p)=="wrapper")var y=new rr([],!0)}for(a=y?a:s;++a<s;){p=t[a];var m=Hs(p),x=m=="wrapper"?ao(p):i;x&&lo(x[0])&&x[1]==(j|le|ce|z)&&!x[4].length&&x[9]==1?y=y[Hs(x[0])].apply(y,x[3]):y=p.length==1&&lo(p)?y[m]():y.thru(p)}return function(){var T=arguments,N=T[0];if(y&&T.length==1&&he(N))return y.plant(N).value();for(var D=0,k=s?t[D].apply(this,T):N;++D<s;)k=t[D].call(this,k);return k}})}function qs(e,t,s,a,l,p,y,m,x,T){var N=t&j,D=t&ie,k=t&ve,Y=t&(le|oe),te=t&fe,de=k?i:Gi(e);function re(){for(var me=arguments.length,be=S(me),Jt=me;Jt--;)be[Jt]=arguments[Jt];if(Y)var Dt=Pi(re),Yt=Vf(be,Dt);if(a&&(be=Fc(be,a,l,Y)),p&&(be=$c(be,p,y,Y)),me-=Yt,Y&&me<T){var Xe=qr(be,Dt);return Bc(e,t,qs,re.placeholder,s,be,Xe,m,x,T-me)}var dr=D?s:this,Tr=k?dr[e]:e;return me=be.length,m?be=Qd(be,m):te&&me>1&&be.reverse(),N&&x<me&&(be.length=x),this&&this!==Pt&&this instanceof re&&(Tr=de||Gi(Tr)),Tr.apply(dr,be)}return re}function kc(e,t){return function(s,a){return ad(s,e,t(a),{})}}function Us(e,t){return function(s,a){var l;if(s===i&&a===i)return t;if(s!==i&&(l=s),a!==i){if(l===i)return a;typeof s=="string"||typeof a=="string"?(s=Gt(s),a=Gt(a)):(s=Cc(s),a=Cc(a)),l=e(s,a)}return l}}function io(e){return Cr(function(t){return t=Ue(t,Kt(Q())),ge(function(s){var a=this;return e(t,function(l){return Vt(l,a,s)})})})}function zs(e,t){t=t===i?" ":Gt(t);var s=t.length;if(s<2)return s?Yn(t,e):t;var a=Yn(t,Cs(e/yi(t)));return vi(t)?Br(lr(a),0,e).join(""):a.slice(0,e)}function Dd(e,t,s,a){var l=t&ie,p=Gi(e);function y(){for(var m=-1,x=arguments.length,T=-1,N=a.length,D=S(N+x),k=this&&this!==Pt&&this instanceof y?p:e;++T<N;)D[T]=a[T];for(;x--;)D[T++]=arguments[++m];return Vt(k,l?s:this,D)}return y}function Hc(e){return function(t,s,a){return a&&typeof a!="number"&&Lt(t,s,a)&&(s=a=i),t=Rr(t),s===i?(s=t,t=0):s=Rr(s),a=a===i?t<s?1:-1:Rr(a),wd(t,s,a,e)}}function ks(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=or(t),s=or(s)),e(t,s)}}function Bc(e,t,s,a,l,p,y,m,x,T){var N=t&le,D=N?y:i,k=N?i:y,Y=N?p:i,te=N?i:p;t|=N?ce:A,t&=~(N?A:ce),t&we||(t&=~(ie|ve));var de=[e,t,l,Y,D,te,k,m,x,T],re=s.apply(i,de);return lo(e)&&ru(re,de),re.placeholder=a,iu(re,e,t)}function so(e){var t=nt[e];return function(s,a){if(s=or(s),a=a==null?0:At(pe(a),292),a&&ic(s)){var l=(Se(s)+"e").split("e"),p=t(l[0]+"e"+(+l[1]+a));return l=(Se(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-a))}return t(s)}}var Fd=_i&&1/ys(new _i([,-0]))[1]==se?function(e){return new _i(e)}:Co;function Vc(e){return function(t){var s=Rt(t);return s==ye?Dn(t):s==Re?Zf(t):Bf(t,e(t))}}function Sr(e,t,s,a,l,p,y,m){var x=t&ve;if(!x&&typeof e!="function")throw new tr(d);var T=a?a.length:0;if(T||(t&=~(ce|A),a=l=i),y=y===i?y:ot(pe(y),0),m=m===i?m:pe(m),T-=l?l.length:0,t&A){var N=a,D=l;a=l=i}var k=x?i:ao(e),Y=[e,t,s,a,l,N,D,p,y,m];if(k&&Yd(Y,k),e=Y[0],t=Y[1],s=Y[2],a=Y[3],l=Y[4],m=Y[9]=Y[9]===i?x?0:e.length:ot(Y[9]-T,0),!m&&t&(le|oe)&&(t&=~(le|oe)),!t||t==ie)var te=Nd(e,t,s);else t==le||t==oe?te=Ld(e,t,m):(t==ce||t==(ie|ce))&&!l.length?te=Dd(e,t,s,a):te=qs.apply(i,Y);var de=k?Pc:ru;return iu(de(te,Y),e,t)}function Kc(e,t,s,a){return e===i||pr(e,wi[s])&&!Ae.call(a,s)?t:e}function Gc(e,t,s,a,l,p){return Ve(e)&&Ve(t)&&(p.set(t,e),Fs(e,t,i,Gc,p),p.delete(t)),e}function $d(e){return Yi(e)?i:e}function Wc(e,t,s,a,l,p){var y=s&F,m=e.length,x=t.length;if(m!=x&&!(y&&x>m))return!1;var T=p.get(e),N=p.get(t);if(T&&N)return T==t&&N==e;var D=-1,k=!0,Y=s&V?new ri:i;for(p.set(e,t),p.set(t,e);++D<m;){var te=e[D],de=t[D];if(a)var re=y?a(de,te,D,t,e,p):a(te,de,D,e,t,p);if(re!==i){if(re)continue;k=!1;break}if(Y){if(!On(t,function(me,be){if(!$i(Y,be)&&(te===me||l(te,me,s,a,p)))return Y.push(be)})){k=!1;break}}else if(!(te===de||l(te,de,s,a,p))){k=!1;break}}return p.delete(e),p.delete(t),k}function jd(e,t,s,a,l,p,y){switch(s){case Be:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new xs(e),new xs(t)));case O:case I:case Pe:return pr(+e,+t);case _:return e.name==t.name&&e.message==t.message;case We:case ze:return e==t+"";case ye:var m=Dn;case Re:var x=a&F;if(m||(m=ys),e.size!=t.size&&!x)return!1;var T=y.get(e);if(T)return T==t;a|=V,y.set(e,t);var N=Wc(m(e),m(t),a,l,p,y);return y.delete(e),N;case ke:if(zi)return zi.call(e)==zi.call(t)}return!1}function Md(e,t,s,a,l,p){var y=s&F,m=no(e),x=m.length,T=no(t),N=T.length;if(x!=N&&!y)return!1;for(var D=x;D--;){var k=m[D];if(!(y?k in t:Ae.call(t,k)))return!1}var Y=p.get(e),te=p.get(t);if(Y&&te)return Y==t&&te==e;var de=!0;p.set(e,t),p.set(t,e);for(var re=y;++D<x;){k=m[D];var me=e[k],be=t[k];if(a)var Jt=y?a(be,me,k,t,e,p):a(me,be,k,e,t,p);if(!(Jt===i?me===be||l(me,be,s,a,p):Jt)){de=!1;break}re||(re=k=="constructor")}if(de&&!re){var Dt=e.constructor,Yt=t.constructor;Dt!=Yt&&"constructor"in e&&"constructor"in t&&!(typeof Dt=="function"&&Dt instanceof Dt&&typeof Yt=="function"&&Yt instanceof Yt)&&(de=!1)}return p.delete(e),p.delete(t),de}function Cr(e){return po(eu(e,i,uu),e+"")}function no(e){return dc(e,Et,uo)}function oo(e){return dc(e,Ut,Jc)}var ao=As?function(e){return As.get(e)}:Co;function Hs(e){for(var t=e.name+"",s=bi[t],a=Ae.call(bi,t)?s.length:0;a--;){var l=s[a],p=l.func;if(p==null||p==e)return l.name}return t}function Pi(e){var t=Ae.call(f,"placeholder")?f:e;return t.placeholder}function Q(){var e=f.iteratee||Po;return e=e===Po?yc:e,arguments.length?e(arguments[0],arguments[1]):e}function Bs(e,t){var s=e.__data__;return Kd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function co(e){for(var t=Et(e),s=t.length;s--;){var a=t[s],l=e[a];t[s]=[a,l,Zc(l)]}return t}function ni(e,t){var s=Jf(e,t);return vc(s)?s:i}function qd(e){var t=Ae.call(e,ei),s=e[ei];try{e[ei]=i;var a=!0}catch{}var l=bs.call(e);return a&&(t?e[ei]=s:delete e[ei]),l}var uo=$n?function(e){return e==null?[]:(e=Le(e),jr($n(e),function(t){return tc.call(e,t)}))}:Oo,Jc=$n?function(e){for(var t=[];e;)Mr(t,uo(e)),e=Is(e);return t}:Oo,Rt=Nt;(jn&&Rt(new jn(new ArrayBuffer(1)))!=Be||Mi&&Rt(new Mi)!=ye||Mn&&Rt(Mn.resolve())!=at||_i&&Rt(new _i)!=Re||qi&&Rt(new qi)!=Fe)&&(Rt=function(e){var t=Nt(e),s=t==xe?e.constructor:i,a=s?oi(s):"";if(a)switch(a){case bp:return Be;case Ep:return ye;case xp:return at;case Ip:return Re;case Pp:return Fe}return t});function Ud(e,t,s){for(var a=-1,l=s.length;++a<l;){var p=s[a],y=p.size;switch(p.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=At(t,e+y);break;case"takeRight":e=ot(e,t-y);break}}return{start:e,end:t}}function zd(e){var t=e.match(wt);return t?t[1].split(_t):[]}function Yc(e,t,s){t=Hr(t,e);for(var a=-1,l=t.length,p=!1;++a<l;){var y=wr(t[a]);if(!(p=e!=null&&s(e,y)))break;e=e[y]}return p||++a!=l?p:(l=e==null?0:e.length,!!l&&Xs(l)&&Or(y,l)&&(he(e)||ai(e)))}function kd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Ae.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Xc(e){return typeof e.constructor=="function"&&!Wi(e)?Ei(Is(e)):{}}function Hd(e,t,s){var a=e.constructor;switch(t){case Ne:return ro(e);case O:case I:return new a(+e);case Be:return Sd(e,s);case it:case ct:case It:case Ot:case Tt:case jt:case Bt:case Zt:case hr:return Lc(e,s);case ye:return new a;case Pe:case ze:return new a(e);case We:return Cd(e);case Re:return new a;case ke:return Od(e)}}function Bd(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(mt,`{
/* [wrapped with `+t+`] */
`)}function Vd(e){return he(e)||ai(e)||!!(rc&&e&&e[rc])}function Or(e,t){var s=typeof e;return t=t??q,!!t&&(s=="number"||s!="symbol"&&rf.test(e))&&e>-1&&e%1==0&&e<t}function Lt(e,t,s){if(!Ve(s))return!1;var a=typeof t;return(a=="number"?qt(s)&&Or(t,s.length):a=="string"&&t in s)?pr(s[t],e):!1}function ho(e,t){if(he(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Wt(e)?!0:dt.test(e)||!pt.test(e)||t!=null&&e in Le(t)}function Kd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function lo(e){var t=Hs(e),s=f[t];if(typeof s!="function"||!(t in _e.prototype))return!1;if(e===s)return!0;var a=ao(s);return!!a&&e===a[0]}function Gd(e){return!!Za&&Za in e}var Wd=ws?Ar:Ao;function Wi(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||wi;return e===s}function Zc(e){return e===e&&!Ve(e)}function Qc(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in Le(s))}}function Jd(e){var t=Js(e,function(a){return s.size===P&&s.clear(),a}),s=t.cache;return t}function Yd(e,t){var s=e[1],a=t[1],l=s|a,p=l<(ie|ve|j),y=a==j&&s==le||a==j&&s==z&&e[7].length<=t[8]||a==(j|z)&&t[7].length<=t[8]&&s==le;if(!(p||y))return e;a&ie&&(e[2]=t[2],l|=s&ie?0:we);var m=t[3];if(m){var x=e[3];e[3]=x?Fc(x,m,t[4]):m,e[4]=x?qr(e[3],L):t[4]}return m=t[5],m&&(x=e[5],e[5]=x?$c(x,m,t[6]):m,e[6]=x?qr(e[5],L):t[6]),m=t[7],m&&(e[7]=m),a&j&&(e[8]=e[8]==null?t[8]:At(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function Xd(e){var t=[];if(e!=null)for(var s in Le(e))t.push(s);return t}function Zd(e){return bs.call(e)}function eu(e,t,s){return t=ot(t===i?e.length-1:t,0),function(){for(var a=arguments,l=-1,p=ot(a.length-t,0),y=S(p);++l<p;)y[l]=a[t+l];l=-1;for(var m=S(t+1);++l<t;)m[l]=a[l];return m[t]=s(y),Vt(e,this,m)}}function tu(e,t){return t.length<2?e:si(e,sr(t,0,-1))}function Qd(e,t){for(var s=e.length,a=At(t.length,s),l=Mt(e);a--;){var p=t[a];e[a]=Or(p,s)?l[p]:i}return e}function fo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var ru=su(Pc),Ji=dp||function(e,t){return Pt.setTimeout(e,t)},po=su(Ed);function iu(e,t,s){var a=t+"";return po(e,Bd(a,eg(zd(a),s)))}function su(e){var t=0,s=0;return function(){var a=mp(),l=De-(a-s);if(s=a,l>0){if(++t>=Ce)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Vs(e,t){var s=-1,a=e.length,l=a-1;for(t=t===i?a:t;++s<t;){var p=Jn(s,l),y=e[p];e[p]=e[s],e[s]=y}return e.length=t,e}var nu=Jd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(gt,function(s,a,l,p){t.push(l?p.replace(Yl,"$1"):a||s)}),t});function wr(e){if(typeof e=="string"||Wt(e))return e;var t=e+"";return t=="0"&&1/e==-se?"-0":t}function oi(e){if(e!=null){try{return _s.call(e)}catch{}try{return e+""}catch{}}return""}function eg(e,t){return er(Fr,function(s){var a="_."+s[0];t&s[1]&&!gs(e,a)&&e.push(a)}),e.sort()}function ou(e){if(e instanceof _e)return e.clone();var t=new rr(e.__wrapped__,e.__chain__);return t.__actions__=Mt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function tg(e,t,s){(s?Lt(e,t,s):t===i)?t=1:t=ot(pe(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var l=0,p=0,y=S(Cs(a/t));l<a;)y[p++]=sr(e,l,l+=t);return y}function rg(e){for(var t=-1,s=e==null?0:e.length,a=0,l=[];++t<s;){var p=e[t];p&&(l[a++]=p)}return l}function ig(){var e=arguments.length;if(!e)return[];for(var t=S(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return Mr(he(s)?Mt(s):[s],St(t,1))}var sg=ge(function(e,t){return Ye(e)?Hi(e,St(t,1,Ye,!0)):[]}),ng=ge(function(e,t){var s=nr(t);return Ye(s)&&(s=i),Ye(e)?Hi(e,St(t,1,Ye,!0),Q(s,2)):[]}),og=ge(function(e,t){var s=nr(t);return Ye(s)&&(s=i),Ye(e)?Hi(e,St(t,1,Ye,!0),i,s):[]});function ag(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:pe(t),sr(e,t<0?0:t,a)):[]}function cg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:pe(t),t=a-t,sr(e,0,t<0?0:t)):[]}function ug(e,t){return e&&e.length?js(e,Q(t,3),!0,!0):[]}function hg(e,t){return e&&e.length?js(e,Q(t,3),!0):[]}function lg(e,t,s,a){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Lt(e,t,s)&&(s=0,a=l),id(e,t,s,a)):[]}function au(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:pe(s);return l<0&&(l=ot(a+l,0)),vs(e,Q(t,3),l)}function cu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a-1;return s!==i&&(l=pe(s),l=s<0?ot(a+l,0):At(l,a-1)),vs(e,Q(t,3),l,!0)}function uu(e){var t=e==null?0:e.length;return t?St(e,1):[]}function fg(e){var t=e==null?0:e.length;return t?St(e,se):[]}function pg(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:pe(t),St(e,t)):[]}function dg(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var l=e[t];a[l[0]]=l[1]}return a}function hu(e){return e&&e.length?e[0]:i}function gg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:pe(s);return l<0&&(l=ot(a+l,0)),gi(e,t,l)}function vg(e){var t=e==null?0:e.length;return t?sr(e,0,-1):[]}var yg=ge(function(e){var t=Ue(e,eo);return t.length&&t[0]===e[0]?Bn(t):[]}),mg=ge(function(e){var t=nr(e),s=Ue(e,eo);return t===nr(s)?t=i:s.pop(),s.length&&s[0]===e[0]?Bn(s,Q(t,2)):[]}),wg=ge(function(e){var t=nr(e),s=Ue(e,eo);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?Bn(s,i,t):[]});function _g(e,t){return e==null?"":vp.call(e,t)}function nr(e){var t=e==null?0:e.length;return t?e[t-1]:i}function bg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a;return s!==i&&(l=pe(s),l=l<0?ot(a+l,0):At(l,a-1)),t===t?ep(e,t,l):vs(e,Ba,l,!0)}function Eg(e,t){return e&&e.length?bc(e,pe(t)):i}var xg=ge(lu);function lu(e,t){return e&&e.length&&t&&t.length?Wn(e,t):e}function Ig(e,t,s){return e&&e.length&&t&&t.length?Wn(e,t,Q(s,2)):e}function Pg(e,t,s){return e&&e.length&&t&&t.length?Wn(e,t,i,s):e}var Sg=Cr(function(e,t){var s=e==null?0:e.length,a=Un(e,t);return Ic(e,Ue(t,function(l){return Or(l,s)?+l:l}).sort(Dc)),a});function Cg(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,l=[],p=e.length;for(t=Q(t,3);++a<p;){var y=e[a];t(y,a,e)&&(s.push(y),l.push(a))}return Ic(e,l),s}function go(e){return e==null?e:_p.call(e)}function Og(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Lt(e,t,s)?(t=0,s=a):(t=t==null?0:pe(t),s=s===i?a:pe(s)),sr(e,t,s)):[]}function Ag(e,t){return $s(e,t)}function Rg(e,t,s){return Xn(e,t,Q(s,2))}function Tg(e,t){var s=e==null?0:e.length;if(s){var a=$s(e,t);if(a<s&&pr(e[a],t))return a}return-1}function Ng(e,t){return $s(e,t,!0)}function Lg(e,t,s){return Xn(e,t,Q(s,2),!0)}function Dg(e,t){var s=e==null?0:e.length;if(s){var a=$s(e,t,!0)-1;if(pr(e[a],t))return a}return-1}function Fg(e){return e&&e.length?Sc(e):[]}function $g(e,t){return e&&e.length?Sc(e,Q(t,2)):[]}function jg(e){var t=e==null?0:e.length;return t?sr(e,1,t):[]}function Mg(e,t,s){return e&&e.length?(t=s||t===i?1:pe(t),sr(e,0,t<0?0:t)):[]}function qg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:pe(t),t=a-t,sr(e,t<0?0:t,a)):[]}function Ug(e,t){return e&&e.length?js(e,Q(t,3),!1,!0):[]}function zg(e,t){return e&&e.length?js(e,Q(t,3)):[]}var kg=ge(function(e){return kr(St(e,1,Ye,!0))}),Hg=ge(function(e){var t=nr(e);return Ye(t)&&(t=i),kr(St(e,1,Ye,!0),Q(t,2))}),Bg=ge(function(e){var t=nr(e);return t=typeof t=="function"?t:i,kr(St(e,1,Ye,!0),i,t)});function Vg(e){return e&&e.length?kr(e):[]}function Kg(e,t){return e&&e.length?kr(e,Q(t,2)):[]}function Gg(e,t){return t=typeof t=="function"?t:i,e&&e.length?kr(e,i,t):[]}function vo(e){if(!(e&&e.length))return[];var t=0;return e=jr(e,function(s){if(Ye(s))return t=ot(s.length,t),!0}),Nn(t,function(s){return Ue(e,An(s))})}function fu(e,t){if(!(e&&e.length))return[];var s=vo(e);return t==null?s:Ue(s,function(a){return Vt(t,i,a)})}var Wg=ge(function(e,t){return Ye(e)?Hi(e,t):[]}),Jg=ge(function(e){return Qn(jr(e,Ye))}),Yg=ge(function(e){var t=nr(e);return Ye(t)&&(t=i),Qn(jr(e,Ye),Q(t,2))}),Xg=ge(function(e){var t=nr(e);return t=typeof t=="function"?t:i,Qn(jr(e,Ye),i,t)}),Zg=ge(vo);function Qg(e,t){return Rc(e||[],t||[],ki)}function ev(e,t){return Rc(e||[],t||[],Ki)}var tv=ge(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,fu(e,s)});function pu(e){var t=f(e);return t.__chain__=!0,t}function rv(e,t){return t(e),e}function Ks(e,t){return t(e)}var iv=Cr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,l=function(p){return Un(p,e)};return t>1||this.__actions__.length||!(a instanceof _e)||!Or(s)?this.thru(l):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Ks,args:[l],thisArg:i}),new rr(a,this.__chain__).thru(function(p){return t&&!p.length&&p.push(i),p}))});function sv(){return pu(this)}function nv(){return new rr(this.value(),this.__chain__)}function ov(){this.__values__===i&&(this.__values__=Cu(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function av(){return this}function cv(e){for(var t,s=this;s instanceof Ts;){var a=ou(s);a.__index__=0,a.__values__=i,t?l.__wrapped__=a:t=a;var l=a;s=s.__wrapped__}return l.__wrapped__=e,t}function uv(){var e=this.__wrapped__;if(e instanceof _e){var t=e;return this.__actions__.length&&(t=new _e(this)),t=t.reverse(),t.__actions__.push({func:Ks,args:[go],thisArg:i}),new rr(t,this.__chain__)}return this.thru(go)}function hv(){return Ac(this.__wrapped__,this.__actions__)}var lv=Ms(function(e,t,s){Ae.call(e,s)?++e[s]:Pr(e,s,1)});function fv(e,t,s){var a=he(e)?ka:rd;return s&&Lt(e,t,s)&&(t=i),a(e,Q(t,3))}function pv(e,t){var s=he(e)?jr:fc;return s(e,Q(t,3))}var dv=Uc(au),gv=Uc(cu);function vv(e,t){return St(Gs(e,t),1)}function yv(e,t){return St(Gs(e,t),se)}function mv(e,t,s){return s=s===i?1:pe(s),St(Gs(e,t),s)}function du(e,t){var s=he(e)?er:zr;return s(e,Q(t,3))}function gu(e,t){var s=he(e)?jf:lc;return s(e,Q(t,3))}var wv=Ms(function(e,t,s){Ae.call(e,s)?e[s].push(t):Pr(e,s,[t])});function _v(e,t,s,a){e=qt(e)?e:Ci(e),s=s&&!a?pe(s):0;var l=e.length;return s<0&&(s=ot(l+s,0)),Zs(e)?s<=l&&e.indexOf(t,s)>-1:!!l&&gi(e,t,s)>-1}var bv=ge(function(e,t,s){var a=-1,l=typeof t=="function",p=qt(e)?S(e.length):[];return zr(e,function(y){p[++a]=l?Vt(t,y,s):Bi(y,t,s)}),p}),Ev=Ms(function(e,t,s){Pr(e,s,t)});function Gs(e,t){var s=he(e)?Ue:mc;return s(e,Q(t,3))}function xv(e,t,s,a){return e==null?[]:(he(t)||(t=t==null?[]:[t]),s=a?i:s,he(s)||(s=s==null?[]:[s]),Ec(e,t,s))}var Iv=Ms(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Pv(e,t,s){var a=he(e)?Cn:Ka,l=arguments.length<3;return a(e,Q(t,4),s,l,zr)}function Sv(e,t,s){var a=he(e)?Mf:Ka,l=arguments.length<3;return a(e,Q(t,4),s,l,lc)}function Cv(e,t){var s=he(e)?jr:fc;return s(e,Ys(Q(t,3)))}function Ov(e){var t=he(e)?ac:_d;return t(e)}function Av(e,t,s){(s?Lt(e,t,s):t===i)?t=1:t=pe(t);var a=he(e)?Xp:bd;return a(e,t)}function Rv(e){var t=he(e)?Zp:xd;return t(e)}function Tv(e){if(e==null)return 0;if(qt(e))return Zs(e)?yi(e):e.length;var t=Rt(e);return t==ye||t==Re?e.size:Kn(e).length}function Nv(e,t,s){var a=he(e)?On:Id;return s&&Lt(e,t,s)&&(t=i),a(e,Q(t,3))}var Lv=ge(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Lt(e,t[0],t[1])?t=[]:s>2&&Lt(t[0],t[1],t[2])&&(t=[t[0]]),Ec(e,St(t,1),[])}),Ws=pp||function(){return Pt.Date.now()};function Dv(e,t){if(typeof t!="function")throw new tr(d);return e=pe(e),function(){if(--e<1)return t.apply(this,arguments)}}function vu(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Sr(e,j,i,i,i,i,t)}function yu(e,t){var s;if(typeof t!="function")throw new tr(d);return e=pe(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var yo=ge(function(e,t,s){var a=ie;if(s.length){var l=qr(s,Pi(yo));a|=ce}return Sr(e,a,t,s,l)}),mu=ge(function(e,t,s){var a=ie|ve;if(s.length){var l=qr(s,Pi(mu));a|=ce}return Sr(t,a,e,s,l)});function wu(e,t,s){t=s?i:t;var a=Sr(e,le,i,i,i,i,i,t);return a.placeholder=wu.placeholder,a}function _u(e,t,s){t=s?i:t;var a=Sr(e,oe,i,i,i,i,i,t);return a.placeholder=_u.placeholder,a}function bu(e,t,s){var a,l,p,y,m,x,T=0,N=!1,D=!1,k=!0;if(typeof e!="function")throw new tr(d);t=or(t)||0,Ve(s)&&(N=!!s.leading,D="maxWait"in s,p=D?ot(or(s.maxWait)||0,t):p,k="trailing"in s?!!s.trailing:k);function Y(Xe){var dr=a,Tr=l;return a=l=i,T=Xe,y=e.apply(Tr,dr),y}function te(Xe){return T=Xe,m=Ji(me,t),N?Y(Xe):y}function de(Xe){var dr=Xe-x,Tr=Xe-T,Uu=t-dr;return D?At(Uu,p-Tr):Uu}function re(Xe){var dr=Xe-x,Tr=Xe-T;return x===i||dr>=t||dr<0||D&&Tr>=p}function me(){var Xe=Ws();if(re(Xe))return be(Xe);m=Ji(me,de(Xe))}function be(Xe){return m=i,k&&a?Y(Xe):(a=l=i,y)}function Jt(){m!==i&&Tc(m),T=0,a=x=l=m=i}function Dt(){return m===i?y:be(Ws())}function Yt(){var Xe=Ws(),dr=re(Xe);if(a=arguments,l=this,x=Xe,dr){if(m===i)return te(x);if(D)return Tc(m),m=Ji(me,t),Y(x)}return m===i&&(m=Ji(me,t)),y}return Yt.cancel=Jt,Yt.flush=Dt,Yt}var Fv=ge(function(e,t){return hc(e,1,t)}),$v=ge(function(e,t,s){return hc(e,or(t)||0,s)});function jv(e){return Sr(e,fe)}function Js(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new tr(d);var s=function(){var a=arguments,l=t?t.apply(this,a):a[0],p=s.cache;if(p.has(l))return p.get(l);var y=e.apply(this,a);return s.cache=p.set(l,y)||p,y};return s.cache=new(Js.Cache||Ir),s}Js.Cache=Ir;function Ys(e){if(typeof e!="function")throw new tr(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Mv(e){return yu(2,e)}var qv=Pd(function(e,t){t=t.length==1&&he(t[0])?Ue(t[0],Kt(Q())):Ue(St(t,1),Kt(Q()));var s=t.length;return ge(function(a){for(var l=-1,p=At(a.length,s);++l<p;)a[l]=t[l].call(this,a[l]);return Vt(e,this,a)})}),mo=ge(function(e,t){var s=qr(t,Pi(mo));return Sr(e,ce,i,t,s)}),Eu=ge(function(e,t){var s=qr(t,Pi(Eu));return Sr(e,A,i,t,s)}),Uv=Cr(function(e,t){return Sr(e,z,i,i,i,t)});function zv(e,t){if(typeof e!="function")throw new tr(d);return t=t===i?t:pe(t),ge(e,t)}function kv(e,t){if(typeof e!="function")throw new tr(d);return t=t==null?0:ot(pe(t),0),ge(function(s){var a=s[t],l=Br(s,0,t);return a&&Mr(l,a),Vt(e,this,l)})}function Hv(e,t,s){var a=!0,l=!0;if(typeof e!="function")throw new tr(d);return Ve(s)&&(a="leading"in s?!!s.leading:a,l="trailing"in s?!!s.trailing:l),bu(e,t,{leading:a,maxWait:t,trailing:l})}function Bv(e){return vu(e,1)}function Vv(e,t){return mo(to(t),e)}function Kv(){if(!arguments.length)return[];var e=arguments[0];return he(e)?e:[e]}function Gv(e){return ir(e,B)}function Wv(e,t){return t=typeof t=="function"?t:i,ir(e,B,t)}function Jv(e){return ir(e,H|B)}function Yv(e,t){return t=typeof t=="function"?t:i,ir(e,H|B,t)}function Xv(e,t){return t==null||uc(e,t,Et(t))}function pr(e,t){return e===t||e!==e&&t!==t}var Zv=ks(Hn),Qv=ks(function(e,t){return e>=t}),ai=gc(function(){return arguments}())?gc:function(e){return Ke(e)&&Ae.call(e,"callee")&&!tc.call(e,"callee")},he=S.isArray,e0=$a?Kt($a):cd;function qt(e){return e!=null&&Xs(e.length)&&!Ar(e)}function Ye(e){return Ke(e)&&qt(e)}function t0(e){return e===!0||e===!1||Ke(e)&&Nt(e)==O}var Vr=gp||Ao,r0=ja?Kt(ja):ud;function i0(e){return Ke(e)&&e.nodeType===1&&!Yi(e)}function s0(e){if(e==null)return!0;if(qt(e)&&(he(e)||typeof e=="string"||typeof e.splice=="function"||Vr(e)||Si(e)||ai(e)))return!e.length;var t=Rt(e);if(t==ye||t==Re)return!e.size;if(Wi(e))return!Kn(e).length;for(var s in e)if(Ae.call(e,s))return!1;return!0}function n0(e,t){return Vi(e,t)}function o0(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?Vi(e,t,i,s):!!a}function wo(e){if(!Ke(e))return!1;var t=Nt(e);return t==_||t==u||typeof e.message=="string"&&typeof e.name=="string"&&!Yi(e)}function a0(e){return typeof e=="number"&&ic(e)}function Ar(e){if(!Ve(e))return!1;var t=Nt(e);return t==X||t==ue||t==C||t==rt}function xu(e){return typeof e=="number"&&e==pe(e)}function Xs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=q}function Ve(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ke(e){return e!=null&&typeof e=="object"}var Iu=Ma?Kt(Ma):ld;function c0(e,t){return e===t||Vn(e,t,co(t))}function u0(e,t,s){return s=typeof s=="function"?s:i,Vn(e,t,co(t),s)}function h0(e){return Pu(e)&&e!=+e}function l0(e){if(Wd(e))throw new ae(h);return vc(e)}function f0(e){return e===null}function p0(e){return e==null}function Pu(e){return typeof e=="number"||Ke(e)&&Nt(e)==Pe}function Yi(e){if(!Ke(e)||Nt(e)!=xe)return!1;var t=Is(e);if(t===null)return!0;var s=Ae.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&_s.call(s)==up}var _o=qa?Kt(qa):fd;function d0(e){return xu(e)&&e>=-q&&e<=q}var Su=Ua?Kt(Ua):pd;function Zs(e){return typeof e=="string"||!he(e)&&Ke(e)&&Nt(e)==ze}function Wt(e){return typeof e=="symbol"||Ke(e)&&Nt(e)==ke}var Si=za?Kt(za):dd;function g0(e){return e===i}function v0(e){return Ke(e)&&Rt(e)==Fe}function y0(e){return Ke(e)&&Nt(e)==He}var m0=ks(Gn),w0=ks(function(e,t){return e<=t});function Cu(e){if(!e)return[];if(qt(e))return Zs(e)?lr(e):Mt(e);if(ji&&e[ji])return Xf(e[ji]());var t=Rt(e),s=t==ye?Dn:t==Re?ys:Ci;return s(e)}function Rr(e){if(!e)return e===0?e:0;if(e=or(e),e===se||e===-se){var t=e<0?-1:1;return t*$}return e===e?e:0}function pe(e){var t=Rr(e),s=t%1;return t===t?s?t-s:t:0}function Ou(e){return e?ii(pe(e),0,U):0}function or(e){if(typeof e=="number")return e;if(Wt(e))return M;if(Ve(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ve(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ga(e);var s=Ql.test(e);return s||tf.test(e)?Df(e.slice(2),s?2:8):Zl.test(e)?M:+e}function Au(e){return mr(e,Ut(e))}function _0(e){return e?ii(pe(e),-q,q):e===0?e:0}function Se(e){return e==null?"":Gt(e)}var b0=xi(function(e,t){if(Wi(t)||qt(t)){mr(t,Et(t),e);return}for(var s in t)Ae.call(t,s)&&ki(e,s,t[s])}),Ru=xi(function(e,t){mr(t,Ut(t),e)}),Qs=xi(function(e,t,s,a){mr(t,Ut(t),e,a)}),E0=xi(function(e,t,s,a){mr(t,Et(t),e,a)}),x0=Cr(Un);function I0(e,t){var s=Ei(e);return t==null?s:cc(s,t)}var P0=ge(function(e,t){e=Le(e);var s=-1,a=t.length,l=a>2?t[2]:i;for(l&&Lt(t[0],t[1],l)&&(a=1);++s<a;)for(var p=t[s],y=Ut(p),m=-1,x=y.length;++m<x;){var T=y[m],N=e[T];(N===i||pr(N,wi[T])&&!Ae.call(e,T))&&(e[T]=p[T])}return e}),S0=ge(function(e){return e.push(i,Gc),Vt(Tu,i,e)});function C0(e,t){return Ha(e,Q(t,3),yr)}function O0(e,t){return Ha(e,Q(t,3),kn)}function A0(e,t){return e==null?e:zn(e,Q(t,3),Ut)}function R0(e,t){return e==null?e:pc(e,Q(t,3),Ut)}function T0(e,t){return e&&yr(e,Q(t,3))}function N0(e,t){return e&&kn(e,Q(t,3))}function L0(e){return e==null?[]:Ds(e,Et(e))}function D0(e){return e==null?[]:Ds(e,Ut(e))}function bo(e,t,s){var a=e==null?i:si(e,t);return a===i?s:a}function F0(e,t){return e!=null&&Yc(e,t,sd)}function Eo(e,t){return e!=null&&Yc(e,t,nd)}var $0=kc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=bs.call(t)),e[t]=s},Io(zt)),j0=kc(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=bs.call(t)),Ae.call(e,t)?e[t].push(s):e[t]=[s]},Q),M0=ge(Bi);function Et(e){return qt(e)?oc(e):Kn(e)}function Ut(e){return qt(e)?oc(e,!0):gd(e)}function q0(e,t){var s={};return t=Q(t,3),yr(e,function(a,l,p){Pr(s,t(a,l,p),a)}),s}function U0(e,t){var s={};return t=Q(t,3),yr(e,function(a,l,p){Pr(s,l,t(a,l,p))}),s}var z0=xi(function(e,t,s){Fs(e,t,s)}),Tu=xi(function(e,t,s,a){Fs(e,t,s,a)}),k0=Cr(function(e,t){var s={};if(e==null)return s;var a=!1;t=Ue(t,function(p){return p=Hr(p,e),a||(a=p.length>1),p}),mr(e,oo(e),s),a&&(s=ir(s,H|K|B,$d));for(var l=t.length;l--;)Zn(s,t[l]);return s});function H0(e,t){return Nu(e,Ys(Q(t)))}var B0=Cr(function(e,t){return e==null?{}:yd(e,t)});function Nu(e,t){if(e==null)return{};var s=Ue(oo(e),function(a){return[a]});return t=Q(t),xc(e,s,function(a,l){return t(a,l[0])})}function V0(e,t,s){t=Hr(t,e);var a=-1,l=t.length;for(l||(l=1,e=i);++a<l;){var p=e==null?i:e[wr(t[a])];p===i&&(a=l,p=s),e=Ar(p)?p.call(e):p}return e}function K0(e,t,s){return e==null?e:Ki(e,t,s)}function G0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Ki(e,t,s,a)}var Lu=Vc(Et),Du=Vc(Ut);function W0(e,t,s){var a=he(e),l=a||Vr(e)||Si(e);if(t=Q(t,4),s==null){var p=e&&e.constructor;l?s=a?new p:[]:Ve(e)?s=Ar(p)?Ei(Is(e)):{}:s={}}return(l?er:yr)(e,function(y,m,x){return t(s,y,m,x)}),s}function J0(e,t){return e==null?!0:Zn(e,t)}function Y0(e,t,s){return e==null?e:Oc(e,t,to(s))}function X0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Oc(e,t,to(s),a)}function Ci(e){return e==null?[]:Ln(e,Et(e))}function Z0(e){return e==null?[]:Ln(e,Ut(e))}function Q0(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=or(s),s=s===s?s:0),t!==i&&(t=or(t),t=t===t?t:0),ii(or(e),t,s)}function ey(e,t,s){return t=Rr(t),s===i?(s=t,t=0):s=Rr(s),e=or(e),od(e,t,s)}function ty(e,t,s){if(s&&typeof s!="boolean"&&Lt(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Rr(e),t===i?(t=e,e=0):t=Rr(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var l=sc();return At(e+l*(t-e+Lf("1e-"+((l+"").length-1))),t)}return Jn(e,t)}var ry=Ii(function(e,t,s){return t=t.toLowerCase(),e+(s?Fu(t):t)});function Fu(e){return xo(Se(e).toLowerCase())}function $u(e){return e=Se(e),e&&e.replace(sf,Kf).replace(xf,"")}function iy(e,t,s){e=Se(e),t=Gt(t);var a=e.length;s=s===i?a:ii(pe(s),0,a);var l=s;return s-=t.length,s>=0&&e.slice(s,l)==t}function sy(e){return e=Se(e),e&&ht.test(e)?e.replace(Fi,Gf):e}function ny(e){return e=Se(e),e&&vt.test(e)?e.replace(Qe,"\\$&"):e}var oy=Ii(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),ay=Ii(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),cy=qc("toLowerCase");function uy(e,t,s){e=Se(e),t=pe(t);var a=t?yi(e):0;if(!t||a>=t)return e;var l=(t-a)/2;return zs(Os(l),s)+e+zs(Cs(l),s)}function hy(e,t,s){e=Se(e),t=pe(t);var a=t?yi(e):0;return t&&a<t?e+zs(t-a,s):e}function ly(e,t,s){e=Se(e),t=pe(t);var a=t?yi(e):0;return t&&a<t?zs(t-a,s)+e:e}function fy(e,t,s){return s||t==null?t=0:t&&(t=+t),wp(Se(e).replace(et,""),t||0)}function py(e,t,s){return(s?Lt(e,t,s):t===i)?t=1:t=pe(t),Yn(Se(e),t)}function dy(){var e=arguments,t=Se(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var gy=Ii(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function vy(e,t,s){return s&&typeof s!="number"&&Lt(e,t,s)&&(t=s=i),s=s===i?U:s>>>0,s?(e=Se(e),e&&(typeof t=="string"||t!=null&&!_o(t))&&(t=Gt(t),!t&&vi(e))?Br(lr(e),0,s):e.split(t,s)):[]}var yy=Ii(function(e,t,s){return e+(s?" ":"")+xo(t)});function my(e,t,s){return e=Se(e),s=s==null?0:ii(pe(s),0,e.length),t=Gt(t),e.slice(s,s+t.length)==t}function wy(e,t,s){var a=f.templateSettings;s&&Lt(e,t,s)&&(t=i),e=Se(e),t=Qs({},t,a,Kc);var l=Qs({},t.imports,a.imports,Kc),p=Et(l),y=Ln(l,p),m,x,T=0,N=t.interpolate||fs,D="__p += '",k=Fn((t.escape||fs).source+"|"+N.source+"|"+(N===st?Xl:fs).source+"|"+(t.evaluate||fs).source+"|$","g"),Y="//# sourceURL="+(Ae.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Of+"]")+`
`;e.replace(k,function(re,me,be,Jt,Dt,Yt){return be||(be=Jt),D+=e.slice(T,Yt).replace(nf,Wf),me&&(m=!0,D+=`' +
__e(`+me+`) +
'`),Dt&&(x=!0,D+=`';
`+Dt+`;
__p += '`),be&&(D+=`' +
((__t = (`+be+`)) == null ? '' : __t) +
'`),T=Yt+re.length,re}),D+=`';
`;var te=Ae.call(t,"variable")&&t.variable;if(!te)D=`with (obj) {
`+D+`
}
`;else if(Jl.test(te))throw new ae(v);D=(x?D.replace($r,""):D).replace(Zr,"$1").replace(fi,"$1;"),D="function("+(te||"obj")+`) {
`+(te?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+D+`return __p
}`;var de=Mu(function(){return Ie(p,Y+"return "+D).apply(i,y)});if(de.source=D,wo(de))throw de;return de}function _y(e){return Se(e).toLowerCase()}function by(e){return Se(e).toUpperCase()}function Ey(e,t,s){if(e=Se(e),e&&(s||t===i))return Ga(e);if(!e||!(t=Gt(t)))return e;var a=lr(e),l=lr(t),p=Wa(a,l),y=Ja(a,l)+1;return Br(a,p,y).join("")}function xy(e,t,s){if(e=Se(e),e&&(s||t===i))return e.slice(0,Xa(e)+1);if(!e||!(t=Gt(t)))return e;var a=lr(e),l=Ja(a,lr(t))+1;return Br(a,0,l).join("")}function Iy(e,t,s){if(e=Se(e),e&&(s||t===i))return e.replace(et,"");if(!e||!(t=Gt(t)))return e;var a=lr(e),l=Wa(a,lr(t));return Br(a,l).join("")}function Py(e,t){var s=Z,a=ne;if(Ve(t)){var l="separator"in t?t.separator:l;s="length"in t?pe(t.length):s,a="omission"in t?Gt(t.omission):a}e=Se(e);var p=e.length;if(vi(e)){var y=lr(e);p=y.length}if(s>=p)return e;var m=s-yi(a);if(m<1)return a;var x=y?Br(y,0,m).join(""):e.slice(0,m);if(l===i)return x+a;if(y&&(m+=x.length-m),_o(l)){if(e.slice(m).search(l)){var T,N=x;for(l.global||(l=Fn(l.source,Se(ga.exec(l))+"g")),l.lastIndex=0;T=l.exec(N);)var D=T.index;x=x.slice(0,D===i?m:D)}}else if(e.indexOf(Gt(l),m)!=m){var k=x.lastIndexOf(l);k>-1&&(x=x.slice(0,k))}return x+a}function Sy(e){return e=Se(e),e&&ut.test(e)?e.replace(pi,tp):e}var Cy=Ii(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),xo=qc("toUpperCase");function ju(e,t,s){return e=Se(e),t=s?i:t,t===i?Yf(e)?sp(e):zf(e):e.match(t)||[]}var Mu=ge(function(e,t){try{return Vt(e,i,t)}catch(s){return wo(s)?s:new ae(s)}}),Oy=Cr(function(e,t){return er(t,function(s){s=wr(s),Pr(e,s,yo(e[s],e))}),e});function Ay(e){var t=e==null?0:e.length,s=Q();return e=t?Ue(e,function(a){if(typeof a[1]!="function")throw new tr(d);return[s(a[0]),a[1]]}):[],ge(function(a){for(var l=-1;++l<t;){var p=e[l];if(Vt(p[0],this,a))return Vt(p[1],this,a)}})}function Ry(e){return td(ir(e,H))}function Io(e){return function(){return e}}function Ty(e,t){return e==null||e!==e?t:e}var Ny=zc(),Ly=zc(!0);function zt(e){return e}function Po(e){return yc(typeof e=="function"?e:ir(e,H))}function Dy(e){return wc(ir(e,H))}function Fy(e,t){return _c(e,ir(t,H))}var $y=ge(function(e,t){return function(s){return Bi(s,e,t)}}),jy=ge(function(e,t){return function(s){return Bi(e,s,t)}});function So(e,t,s){var a=Et(t),l=Ds(t,a);s==null&&!(Ve(t)&&(l.length||!a.length))&&(s=t,t=e,e=this,l=Ds(t,Et(t)));var p=!(Ve(s)&&"chain"in s)||!!s.chain,y=Ar(e);return er(l,function(m){var x=t[m];e[m]=x,y&&(e.prototype[m]=function(){var T=this.__chain__;if(p||T){var N=e(this.__wrapped__),D=N.__actions__=Mt(this.__actions__);return D.push({func:x,args:arguments,thisArg:e}),N.__chain__=T,N}return x.apply(e,Mr([this.value()],arguments))})}),e}function My(){return Pt._===this&&(Pt._=hp),this}function Co(){}function qy(e){return e=pe(e),ge(function(t){return bc(t,e)})}var Uy=io(Ue),zy=io(ka),ky=io(On);function qu(e){return ho(e)?An(wr(e)):md(e)}function Hy(e){return function(t){return e==null?i:si(e,t)}}var By=Hc(),Vy=Hc(!0);function Oo(){return[]}function Ao(){return!1}function Ky(){return{}}function Gy(){return""}function Wy(){return!0}function Jy(e,t){if(e=pe(e),e<1||e>q)return[];var s=U,a=At(e,U);t=Q(t),e-=U;for(var l=Nn(a,t);++s<e;)t(s);return l}function Yy(e){return he(e)?Ue(e,wr):Wt(e)?[e]:Mt(nu(Se(e)))}function Xy(e){var t=++cp;return Se(e)+t}var Zy=Us(function(e,t){return e+t},0),Qy=so("ceil"),e1=Us(function(e,t){return e/t},1),t1=so("floor");function r1(e){return e&&e.length?Ls(e,zt,Hn):i}function i1(e,t){return e&&e.length?Ls(e,Q(t,2),Hn):i}function s1(e){return Va(e,zt)}function n1(e,t){return Va(e,Q(t,2))}function o1(e){return e&&e.length?Ls(e,zt,Gn):i}function a1(e,t){return e&&e.length?Ls(e,Q(t,2),Gn):i}var c1=Us(function(e,t){return e*t},1),u1=so("round"),h1=Us(function(e,t){return e-t},0);function l1(e){return e&&e.length?Tn(e,zt):0}function f1(e,t){return e&&e.length?Tn(e,Q(t,2)):0}return f.after=Dv,f.ary=vu,f.assign=b0,f.assignIn=Ru,f.assignInWith=Qs,f.assignWith=E0,f.at=x0,f.before=yu,f.bind=yo,f.bindAll=Oy,f.bindKey=mu,f.castArray=Kv,f.chain=pu,f.chunk=tg,f.compact=rg,f.concat=ig,f.cond=Ay,f.conforms=Ry,f.constant=Io,f.countBy=lv,f.create=I0,f.curry=wu,f.curryRight=_u,f.debounce=bu,f.defaults=P0,f.defaultsDeep=S0,f.defer=Fv,f.delay=$v,f.difference=sg,f.differenceBy=ng,f.differenceWith=og,f.drop=ag,f.dropRight=cg,f.dropRightWhile=ug,f.dropWhile=hg,f.fill=lg,f.filter=pv,f.flatMap=vv,f.flatMapDeep=yv,f.flatMapDepth=mv,f.flatten=uu,f.flattenDeep=fg,f.flattenDepth=pg,f.flip=jv,f.flow=Ny,f.flowRight=Ly,f.fromPairs=dg,f.functions=L0,f.functionsIn=D0,f.groupBy=wv,f.initial=vg,f.intersection=yg,f.intersectionBy=mg,f.intersectionWith=wg,f.invert=$0,f.invertBy=j0,f.invokeMap=bv,f.iteratee=Po,f.keyBy=Ev,f.keys=Et,f.keysIn=Ut,f.map=Gs,f.mapKeys=q0,f.mapValues=U0,f.matches=Dy,f.matchesProperty=Fy,f.memoize=Js,f.merge=z0,f.mergeWith=Tu,f.method=$y,f.methodOf=jy,f.mixin=So,f.negate=Ys,f.nthArg=qy,f.omit=k0,f.omitBy=H0,f.once=Mv,f.orderBy=xv,f.over=Uy,f.overArgs=qv,f.overEvery=zy,f.overSome=ky,f.partial=mo,f.partialRight=Eu,f.partition=Iv,f.pick=B0,f.pickBy=Nu,f.property=qu,f.propertyOf=Hy,f.pull=xg,f.pullAll=lu,f.pullAllBy=Ig,f.pullAllWith=Pg,f.pullAt=Sg,f.range=By,f.rangeRight=Vy,f.rearg=Uv,f.reject=Cv,f.remove=Cg,f.rest=zv,f.reverse=go,f.sampleSize=Av,f.set=K0,f.setWith=G0,f.shuffle=Rv,f.slice=Og,f.sortBy=Lv,f.sortedUniq=Fg,f.sortedUniqBy=$g,f.split=vy,f.spread=kv,f.tail=jg,f.take=Mg,f.takeRight=qg,f.takeRightWhile=Ug,f.takeWhile=zg,f.tap=rv,f.throttle=Hv,f.thru=Ks,f.toArray=Cu,f.toPairs=Lu,f.toPairsIn=Du,f.toPath=Yy,f.toPlainObject=Au,f.transform=W0,f.unary=Bv,f.union=kg,f.unionBy=Hg,f.unionWith=Bg,f.uniq=Vg,f.uniqBy=Kg,f.uniqWith=Gg,f.unset=J0,f.unzip=vo,f.unzipWith=fu,f.update=Y0,f.updateWith=X0,f.values=Ci,f.valuesIn=Z0,f.without=Wg,f.words=ju,f.wrap=Vv,f.xor=Jg,f.xorBy=Yg,f.xorWith=Xg,f.zip=Zg,f.zipObject=Qg,f.zipObjectDeep=ev,f.zipWith=tv,f.entries=Lu,f.entriesIn=Du,f.extend=Ru,f.extendWith=Qs,So(f,f),f.add=Zy,f.attempt=Mu,f.camelCase=ry,f.capitalize=Fu,f.ceil=Qy,f.clamp=Q0,f.clone=Gv,f.cloneDeep=Jv,f.cloneDeepWith=Yv,f.cloneWith=Wv,f.conformsTo=Xv,f.deburr=$u,f.defaultTo=Ty,f.divide=e1,f.endsWith=iy,f.eq=pr,f.escape=sy,f.escapeRegExp=ny,f.every=fv,f.find=dv,f.findIndex=au,f.findKey=C0,f.findLast=gv,f.findLastIndex=cu,f.findLastKey=O0,f.floor=t1,f.forEach=du,f.forEachRight=gu,f.forIn=A0,f.forInRight=R0,f.forOwn=T0,f.forOwnRight=N0,f.get=bo,f.gt=Zv,f.gte=Qv,f.has=F0,f.hasIn=Eo,f.head=hu,f.identity=zt,f.includes=_v,f.indexOf=gg,f.inRange=ey,f.invoke=M0,f.isArguments=ai,f.isArray=he,f.isArrayBuffer=e0,f.isArrayLike=qt,f.isArrayLikeObject=Ye,f.isBoolean=t0,f.isBuffer=Vr,f.isDate=r0,f.isElement=i0,f.isEmpty=s0,f.isEqual=n0,f.isEqualWith=o0,f.isError=wo,f.isFinite=a0,f.isFunction=Ar,f.isInteger=xu,f.isLength=Xs,f.isMap=Iu,f.isMatch=c0,f.isMatchWith=u0,f.isNaN=h0,f.isNative=l0,f.isNil=p0,f.isNull=f0,f.isNumber=Pu,f.isObject=Ve,f.isObjectLike=Ke,f.isPlainObject=Yi,f.isRegExp=_o,f.isSafeInteger=d0,f.isSet=Su,f.isString=Zs,f.isSymbol=Wt,f.isTypedArray=Si,f.isUndefined=g0,f.isWeakMap=v0,f.isWeakSet=y0,f.join=_g,f.kebabCase=oy,f.last=nr,f.lastIndexOf=bg,f.lowerCase=ay,f.lowerFirst=cy,f.lt=m0,f.lte=w0,f.max=r1,f.maxBy=i1,f.mean=s1,f.meanBy=n1,f.min=o1,f.minBy=a1,f.stubArray=Oo,f.stubFalse=Ao,f.stubObject=Ky,f.stubString=Gy,f.stubTrue=Wy,f.multiply=c1,f.nth=Eg,f.noConflict=My,f.noop=Co,f.now=Ws,f.pad=uy,f.padEnd=hy,f.padStart=ly,f.parseInt=fy,f.random=ty,f.reduce=Pv,f.reduceRight=Sv,f.repeat=py,f.replace=dy,f.result=V0,f.round=u1,f.runInContext=E,f.sample=Ov,f.size=Tv,f.snakeCase=gy,f.some=Nv,f.sortedIndex=Ag,f.sortedIndexBy=Rg,f.sortedIndexOf=Tg,f.sortedLastIndex=Ng,f.sortedLastIndexBy=Lg,f.sortedLastIndexOf=Dg,f.startCase=yy,f.startsWith=my,f.subtract=h1,f.sum=l1,f.sumBy=f1,f.template=wy,f.times=Jy,f.toFinite=Rr,f.toInteger=pe,f.toLength=Ou,f.toLower=_y,f.toNumber=or,f.toSafeInteger=_0,f.toString=Se,f.toUpper=by,f.trim=Ey,f.trimEnd=xy,f.trimStart=Iy,f.truncate=Py,f.unescape=Sy,f.uniqueId=Xy,f.upperCase=Cy,f.upperFirst=xo,f.each=du,f.eachRight=gu,f.first=hu,So(f,function(){var e={};return yr(f,function(t,s){Ae.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,er(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),er(["drop","take"],function(e,t){_e.prototype[e]=function(s){s=s===i?1:ot(pe(s),0);var a=this.__filtered__&&!t?new _e(this):this.clone();return a.__filtered__?a.__takeCount__=At(s,a.__takeCount__):a.__views__.push({size:At(s,U),type:e+(a.__dir__<0?"Right":"")}),a},_e.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),er(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==g||s==J;_e.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:Q(l,3),type:s}),p.__filtered__=p.__filtered__||a,p}}),er(["head","last"],function(e,t){var s="take"+(t?"Right":"");_e.prototype[e]=function(){return this[s](1).value()[0]}}),er(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");_e.prototype[e]=function(){return this.__filtered__?new _e(this):this[s](1)}}),_e.prototype.compact=function(){return this.filter(zt)},_e.prototype.find=function(e){return this.filter(e).head()},_e.prototype.findLast=function(e){return this.reverse().find(e)},_e.prototype.invokeMap=ge(function(e,t){return typeof e=="function"?new _e(this):this.map(function(s){return Bi(s,e,t)})}),_e.prototype.reject=function(e){return this.filter(Ys(Q(e)))},_e.prototype.slice=function(e,t){e=pe(e);var s=this;return s.__filtered__&&(e>0||t<0)?new _e(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=pe(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},_e.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},_e.prototype.toArray=function(){return this.take(U)},yr(_e.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),l=f[a?"take"+(t=="last"?"Right":""):t],p=a||/^find/.test(t);l&&(f.prototype[t]=function(){var y=this.__wrapped__,m=a?[1]:arguments,x=y instanceof _e,T=m[0],N=x||he(y),D=function(me){var be=l.apply(f,Mr([me],m));return a&&k?be[0]:be};N&&s&&typeof T=="function"&&T.length!=1&&(x=N=!1);var k=this.__chain__,Y=!!this.__actions__.length,te=p&&!k,de=x&&!Y;if(!p&&N){y=de?y:new _e(this);var re=e.apply(y,m);return re.__actions__.push({func:Ks,args:[D],thisArg:i}),new rr(re,k)}return te&&de?e.apply(this,m):(re=this.thru(D),te?a?re.value()[0]:re.value():re)})}),er(["pop","push","shift","sort","splice","unshift"],function(e){var t=ms[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(a&&!this.__chain__){var p=this.value();return t.apply(he(p)?p:[],l)}return this[s](function(y){return t.apply(he(y)?y:[],l)})}}),yr(_e.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";Ae.call(bi,a)||(bi[a]=[]),bi[a].push({name:t,func:s})}}),bi[qs(i,ve).name]=[{name:"wrapper",func:i}],_e.prototype.clone=Sp,_e.prototype.reverse=Cp,_e.prototype.value=Op,f.prototype.at=iv,f.prototype.chain=sv,f.prototype.commit=nv,f.prototype.next=ov,f.prototype.plant=cv,f.prototype.reverse=uv,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=hv,f.prototype.first=f.prototype.head,ji&&(f.prototype[ji]=av),f},mi=np();Qr?((Qr.exports=mi)._=mi,In._=mi):Pt._=mi}).call(os)})(Xo,Xo.exports);var lE=Object.defineProperty,fE=Object.defineProperties,pE=Object.getOwnPropertyDescriptors,kh=Object.getOwnPropertySymbols,dE=Object.prototype.hasOwnProperty,gE=Object.prototype.propertyIsEnumerable,Hh=(c,r,i)=>r in c?lE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,tn=(c,r)=>{for(var i in r||(r={}))dE.call(r,i)&&Hh(c,i,r[i]);if(kh)for(var i of kh(r))gE.call(r,i)&&Hh(c,i,r[i]);return c},vE=(c,r)=>fE(c,pE(r));function ur(c,r,i){let n;const o=Zo(c);return r.rpcMap&&(n=r.rpcMap[o]),n||(n=`${hE}?chainId=eip155:${o}&projectId=${i}`),n}function Zo(c){return c.includes("eip155")?Number(c.split(":")[1]):Number(c)}function Gl(c){return c.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function yE(c,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(c));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function mE(c={},r={}){const i=Bh(c),n=Bh(r);return Xo.exports.merge(i,n)}function Bh(c){var r,i,n,o;const h={};if(!nn(c))return h;for(const[d,v]of Object.entries(c)){const w=sl(d)?[d]:v.chains,P=v.methods||[],L=v.events||[],H=v.rpcMap||{},K=on(d);h[K]=vE(tn(tn({},h[K]),v),{chains:To(w,(r=h[K])==null?void 0:r.chains),methods:To(P,(i=h[K])==null?void 0:i.methods),events:To(L,(n=h[K])==null?void 0:n.events),rpcMap:tn(tn({},H),(o=h[K])==null?void 0:o.rpcMap)})}return h}function wE(c){return c.includes(":")?c.split(":")[2]:c}function _E(c){const r={};for(const[i,n]of Object.entries(c)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],v=sl(i)?[i]:n.chains?n.chains:Gl(n.accounts);r[i]={chains:v,methods:o,events:h,accounts:d}}return r}const Wl={},Ze=c=>Wl[c],Ho=(c,r)=>{Wl[c]=r};class bE{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||ur(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ur(r,this.namespace);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}class EE{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){const n=Zo(r);if(!this.httpProviders[n]){const o=i||ur(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,o)}this.chainId=n,this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||ur(`${this.name}:${r}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Zo(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class xE{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||ur(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ur(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}class IE{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||ur(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ur(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}class PE{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i);r[i]=this.createHttpProvider(i,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}class SE{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||ur(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ur(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}class CE{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=Ze("events"),this.client=Ze("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||ur(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(Xr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||ur(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Yr(new li(n,Ze("disableProviderPing")))}}var OE=Object.defineProperty,AE=Object.defineProperties,RE=Object.getOwnPropertyDescriptors,Vh=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,NE=Object.prototype.propertyIsEnumerable,Kh=(c,r,i)=>r in c?OE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,rn=(c,r)=>{for(var i in r||(r={}))TE.call(r,i)&&Kh(c,i,r[i]);if(Vh)for(var i of Vh(r))NE.call(r,i)&&Kh(c,i,r[i]);return c},Bo=(c,r)=>AE(c,RE(r));class pa{constructor(r){this.events=new ia,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Uh})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new pa(r);return await i.initialize(),i}async request(r,i){const[n,o]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:rn({},r),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(o=>i(null,o)).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:$t("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=_E(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Vl)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(Li(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await iE.init({logger:this.providerOpts.logger||Uh,relayUrl:this.providerOpts.relayUrl||aE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>on(i)))];Ho("client",this.client),Ho("events",this.events),Ho("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=yE(i,this.session),o=Gl(n),h=mE(this.namespaces,this.optionalNamespaces),d=Bo(rn({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new EE({namespace:d});break;case"solana":this.rpcProviders[i]=new xE({namespace:d});break;case"cosmos":this.rpcProviders[i]=new IE({namespace:d});break;case"polkadot":this.rpcProviders[i]=new bE({namespace:d});break;case"cip34":this.rpcProviders[i]=new PE({namespace:d});break;case"elrond":this.rpcProviders[i]=new SE({namespace:d});break;case"multiversx":this.rpcProviders[i]=new CE({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&Li(o)&&this.events.emit("accountsChanged",o.map(wE))}else n.name==="chainChanged"?this.onChainChanged(i.chainId):this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=Bo(rn({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",Bo(rn({},$t("USER_DISCONNECTED")),{data:r.topic}))}),this.on(Xr.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>on(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=on(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(r);i||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${zh}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${zh}/${r}`)}}const LE=pa,DE="wc",FE="ethereum_provider",$E=`${DE}@2:${FE}:`,jE="https://rpc.walletconnect.com/v1/",Qo=["eth_sendTransaction","personal_sign"],ME=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],ea=["chainChanged","accountsChanged"],qE=["message","disconnect","connect"];var UE=Object.defineProperty,zE=Object.defineProperties,kE=Object.getOwnPropertyDescriptors,Gh=Object.getOwnPropertySymbols,HE=Object.prototype.hasOwnProperty,BE=Object.prototype.propertyIsEnumerable,Wh=(c,r,i)=>r in c?UE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,as=(c,r)=>{for(var i in r||(r={}))HE.call(r,i)&&Wh(c,i,r[i]);if(Gh)for(var i of Gh(r))BE.call(r,i)&&Wh(c,i,r[i]);return c},Jh=(c,r)=>zE(c,kE(r));function hn(c){return Number(c[0].split(":")[1])}function Vo(c){return`0x${c.toString(16)}`}function VE(c){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:v}=c;if(!Li(r))throw new Error("Invalid chains");const w={chains:r,methods:n||Qo,events:h||ea,rpcMap:as({},r.length?{[hn(r)]:v[hn(r)]}:{})},P=h==null?void 0:h.filter(B=>!ea.includes(B)),L=n==null?void 0:n.filter(B=>!Qo.includes(B));if(!i&&!d&&!o&&!(P!=null&&P.length)&&!(L!=null&&L.length))return{required:r.length?w:void 0};const H=(P==null?void 0:P.length)&&(L==null?void 0:L.length)||!i,K={chains:[...new Set(H?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:ME))],events:[...new Set(w.events.concat(d||qE))],rpcMap:v};return{required:r.length?w:void 0,optional:i.length?K:void 0}}class da{constructor(){this.events=new Xt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=$E,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new da;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=VE(this.rpc);try{const o=await new Promise(async(d,v)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(P=>{!P.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Jh(as({namespaces:as({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(P=>{d(P)}).catch(P=>{v(new Error(P.message))})});if(!o)return;this.setChainIds(this.rpc.chains);const h=Z1(o.namespaces,[this.namespace]);this.setAccounts(h),this.events.emit("connect",{chainId:Vo(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",Vo(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Jh(as({},$t("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",Vo(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],h=(n=r==null?void 0:r.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=o.length?(r==null?void 0:r.methods)||Qo:[],w=o.length?(r==null?void 0:r.events)||ea:[],P=(r==null?void 0:r.optionalMethods)||[],L=(r==null?void 0:r.optionalEvents)||[],H=(r==null?void 0:r.rpcMap)||this.buildRpcMap(d,r.projectId),K=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(B=>this.formatChainId(B)),optionalChains:h.map(B=>this.formatChainId(B)),methods:v,events:w,optionalMethods:P,optionalEvents:L,rpcMap:H,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:K,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?hn(this.rpc.chains):hn(this.rpc.optionalChains),this.signer=await LE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Q1(()=>import("./index-7a479496.js").then(o=>o.a),["assets/index-7a479496.js","assets/index-dc415d61.js","assets/index-9bc423ed.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(as({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&Li(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&Li(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${jE}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const tx=da;export{tx as EthereumProvider,qE as OPTIONAL_EVENTS,ME as OPTIONAL_METHODS,ea as REQUIRED_EVENTS,Qo as REQUIRED_METHODS,da as default};
